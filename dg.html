<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#008751">
  
  <!-- iOS PWA Settings -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ARCON DG">
  
  <title>ARCON | DG Executive Dashboard</title>
  
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  
  <!-- Icons -->
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  
  <!-- Map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            arconGreen: "#008751",
            arconGreenDark: "#00643C",
            arconGold: "#D4AF37",
            arconGoldLight: "#F4D03F",
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            serif: ['Merriweather', 'serif'],
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-out',
            'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1)',
            'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          },
          keyframes: {
            fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
            slideUp: { '0%': { transform: 'translateY(100%)' }, '100%': { transform: 'translateY(0)' } }
          },
          backgroundImage: {
            'green-gradient': 'linear-gradient(135deg, #008751 0%, #005a32 100%)',
            'gold-gradient': 'linear-gradient(135deg, #D4AF37 0%, #B4941F 100%)',
          }
        }
      }
    }
  </script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Merriweather:wght@400;700;900&display=swap');
    
    body { 
      font-family: Inter, sans-serif; 
      background: #f8fafc; 
      -webkit-tap-highlight-color: transparent;
      overscroll-behavior-y: none;
    }
    
    .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    .pt-safe { padding-top: env(safe-area-inset-top); }
    .bottom-nav-safe { padding-bottom: max(env(safe-area-inset-bottom), 12px); }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    
    .card-hover { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .card-hover:hover { transform: translateY(-4px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
  </style>
</head>

<body class="flex h-screen overflow-hidden text-gray-800 bg-slate-50 pb-[calc(70px+env(safe-area-inset-bottom))] md:pb-0">

  <!-- APP CONTAINER -->
  <div id="app-container" class="flex h-full w-full">
    
    <!-- DESKTOP SIDEBAR -->
    <aside class="hidden md:flex w-72 bg-green-gradient text-white border-r border-white/10 flex-col flex-shrink-0 z-20 relative shadow-xl">
      <div class="h-24 flex items-center px-6 border-b border-white/10">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-white rounded-xl flex items-center justify-center shadow-lg transform rotate-3 transition hover:rotate-0">
             <img src="https://raw.githubusercontent.com/KingAmada/arcon/refs/heads/main/arcon.jpg" class="w-9 h-9 object-contain">
          </div>
          <div>
            <h1 class="font-extrabold text-white text-xl tracking-tight leading-none">ARCON</h1>
            <div class="text-[10px] font-bold text-green-100/80 uppercase tracking-[0.15em] mt-1">Executive Suite</div>
          </div>
        </div>
      </div>
      
      <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
        <div class="px-3 py-2">
          <p class="text-[10px] font-black uppercase tracking-widest text-green-200/60 mb-3">High Command</p>
          <button onclick="setView('overview')" class="desktop-nav-btn group w-full text-left px-4 py-4 rounded-xl flex items-center gap-3 text-sm font-semibold transition-all duration-200 text-white/80 hover:bg-white/10 hover:text-white hover:shadow-lg">
            <i class="ph ph-chart-line-up text-xl"></i> Overview
          </button>
          <button onclick="setView('agencies')" class="desktop-nav-btn group w-full text-left px-4 py-4 rounded-xl flex items-center gap-3 text-sm font-semibold transition-all duration-200 text-white/80 hover:bg-white/10 hover:text-white hover:shadow-lg">
            <i class="ph ph-buildings text-xl"></i> Agency Registry
          </button>
          <button onclick="setView('map')" class="desktop-nav-btn group w-full text-left px-4 py-4 rounded-xl flex items-center gap-3 text-sm font-semibold transition-all duration-200 text-white/80 hover:bg-white/10 hover:text-white hover:shadow-lg">
            <i class="ph ph-globe-hemisphere-west text-xl"></i> National Map
          </button>
        </div>
        
        <div class="px-3 py-2 mt-4">
           <p class="text-[10px] font-black uppercase tracking-widest text-green-200/60 mb-3">Intelligence</p>
           <button onclick="setView('reports')" class="desktop-nav-btn group w-full text-left px-4 py-4 rounded-xl flex items-center gap-3 text-sm font-semibold transition-all duration-200 text-white/80 hover:bg-white/10 hover:text-white hover:shadow-lg">
            <i class="ph ph-file-pdf text-xl"></i> Reports Center
          </button>
        </div>
      </nav>

      <div class="p-4 border-t border-white/10">
        <div class="bg-black/20 rounded-2xl p-4 text-white backdrop-blur-sm border border-white/5">
          <div class="flex items-center justify-between mb-3">
            <div class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center font-bold border border-white/10">
              <i class="ph ph-crown text-2xl text-arconGold"></i>
            </div>
            <div class="h-2 w-2 rounded-full bg-green-400 animate-pulse shadow-[0_0_8px_rgba(74,222,128,0.5)]"></div>
          </div>
          <div>
            <div class="text-xs text-white/60 font-medium uppercase tracking-wide">Welcome,</div>
            <div class="font-bold text-base">Director General</div>
          </div>
        </div>
      </div>
    </aside>

    <!-- MOBILE BOTTOM NAV -->
    <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-lg border-t border-gray-200 flex items-center justify-around z-40 shadow-[0_-4px_20px_rgba(0,0,0,0.05)] bottom-nav-safe h-[calc(70px+env(safe-area-inset-bottom))]">
      <button onclick="setView('overview')" id="mob-nav-overview" class="mobile-nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400 active text-arconGreen transition-colors group">
        <div class="p-1.5 rounded-xl group-hover:bg-gray-50 transition-colors">
          <i class="ph ph-chart-line-up text-2xl mb-0.5"></i>
        </div>
        <span class="text-[10px] font-bold">Stats</span>
      </button>
      <button onclick="setView('agencies')" id="mob-nav-agencies" class="mobile-nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400 transition-colors group">
        <div class="p-1.5 rounded-xl group-hover:bg-gray-50 transition-colors">
          <i class="ph ph-buildings text-2xl mb-0.5"></i>
        </div>
        <span class="text-[10px] font-bold">Agencies</span>
      </button>
      <button onclick="setView('reports')" id="mob-nav-reports" class="mobile-nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400 transition-colors group">
        <div class="p-1.5 rounded-xl group-hover:bg-gray-50 transition-colors">
          <i class="ph ph-file-pdf text-2xl mb-0.5"></i>
        </div>
        <span class="text-[10px] font-bold">Reports</span>
      </button>
      <button onclick="setView('map')" id="mob-nav-map" class="mobile-nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400 transition-colors group">
        <div class="p-1.5 rounded-xl group-hover:bg-gray-50 transition-colors">
          <i class="ph ph-globe-hemisphere-west text-2xl mb-0.5"></i>
        </div>
        <span class="text-[10px] font-bold">Map</span>
      </button>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="flex-1 flex flex-col min-w-0 bg-slate-50/50 pt-safe">
      
      <!-- Header -->
      <header class="h-16 md:h-24 bg-white/80 backdrop-blur-md border-b border-gray-200/60 flex items-center justify-between px-4 md:px-8 sticky top-0 md:relative z-10">
        <div>
           <h2 class="font-black text-gray-800 text-xl md:text-2xl flex items-center gap-3 tracking-tight">
             <span class="md:hidden text-arconGreen"><img src="https://raw.githubusercontent.com/KingAmada/arcon/refs/heads/main/arcon.jpg" class="w-8 h-8 object-contain"></span>
             <span id="page-title">Executive Dashboard</span>
           </h2>
           <p class="hidden md:block text-sm text-gray-500 font-medium mt-1">Real-time regulatory oversight & revenue metrics</p>
        </div>
        <div class="flex items-center gap-3">
           <span class="hidden md:flex items-center gap-2 px-3 py-1 bg-green-50 text-arconGreen text-xs font-bold rounded-full border border-green-100">
             <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span> Live
           </span>
           <button onclick="location.reload()" class="w-10 h-10 flex items-center justify-center text-gray-400 hover:text-arconGreen hover:bg-green-50 transition-all rounded-full active:scale-95 bg-white border border-gray-100 shadow-sm">
             <i class="ph ph-arrows-clockwise text-xl"></i>
           </button>
        </div>
      </header>

      <!-- Content Scroll Area -->
      <div class="flex-1 overflow-y-auto p-4 md:p-8 relative">

        <!-- VIEW: OVERVIEW -->
        <div id="view-overview" class="space-y-6 animate-fade-in pb-8">
          <!-- Filters (Existing) -->
          <div class="bg-white p-4 rounded-2xl border border-gray-100 shadow-sm flex flex-col md:flex-row gap-4 items-center justify-between sticky top-0 z-20 md:relative">
             <div class="flex items-center gap-2 w-full md:w-auto text-gray-500 text-sm font-bold">
               <i class="ph ph-funnel text-arconGreen"></i> Drill Down:
             </div>
             <div class="flex gap-2 w-full md:w-auto overflow-x-auto">
               <select id="filter-state" onchange="populateLgas()" class="bg-slate-50 border border-gray-200 text-sm rounded-xl px-4 py-2.5 outline-none font-medium min-w-[140px] focus:ring-2 focus:ring-arconGreen/20">
                  <option value="all">All States</option>
                  <!-- Populated JS -->
               </select>
               <select id="filter-lga" class="bg-slate-50 border border-gray-200 text-sm rounded-xl px-4 py-2.5 outline-none font-medium min-w-[140px] focus:ring-2 focus:ring-arconGreen/20">
                  <option value="all">All LGAs</option>
               </select>
               <button onclick="applyFilters()" class="bg-arconGreen text-white px-4 py-2.5 rounded-xl font-bold shadow-lg shadow-arconGreen/20 hover:bg-arconGreenDark transition">
                 Update View
               </button>
             </div>
          </div>

          <!-- Expanded Metrics Grid -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <!-- Metric 1 -->
            <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm card-hover group">
              <div class="flex justify-between items-start mb-3">
                 <div class="w-10 h-10 rounded-xl bg-green-50 text-arconGreen flex items-center justify-center text-xl"><i class="ph ph-currency-ngn"></i></div>
                 <span class="text-green-600 text-[10px] font-bold bg-green-50 px-2 py-1 rounded-full">+12%</span>
              </div>
              <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Revenue</p>
              <h3 class="text-2xl font-black text-gray-800 mt-0.5">₦45.2M</h3>
            </div>

            <!-- Metric 2 -->
            <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm card-hover group">
              <div class="flex justify-between items-start mb-3">
                 <div class="w-10 h-10 rounded-xl bg-yellow-50 text-arconGold flex items-center justify-center text-xl"><i class="ph ph-shield-check"></i></div>
              </div>
              <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Compliance</p>
              <h3 class="text-2xl font-black text-gray-800 mt-0.5">68%</h3>
            </div>

            <!-- Metric 3 -->
            <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm card-hover group">
              <div class="flex justify-between items-start mb-3">
                 <div class="w-10 h-10 rounded-xl bg-blue-50 text-blue-600 flex items-center justify-center text-xl"><i class="ph ph-buildings"></i></div>
              </div>
              <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Agencies</p>
              <h3 class="text-2xl font-black text-gray-800 mt-0.5">1,240</h3>
            </div>

            <!-- Metric 4 -->
            <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm card-hover group">
              <div class="flex justify-between items-start mb-3">
                 <div class="w-10 h-10 rounded-xl bg-red-50 text-red-600 flex items-center justify-center text-xl"><i class="ph ph-gavel"></i></div>
              </div>
              <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Enforcements</p>
              <h3 class="text-2xl font-black text-gray-800 mt-0.5">85</h3>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Main Chart -->
            <div class="lg:col-span-2 bg-white p-6 rounded-3xl border border-gray-100 shadow-sm">
               <div class="flex justify-between items-center mb-6">
                 <div>
                   <h4 class="font-bold text-gray-800 text-lg">Revenue Trend</h4>
                   <p class="text-xs text-gray-400">Monthly breakdown (Millions NGN)</p>
                 </div>
                 <button class="text-arconGreen hover:bg-green-50 p-2 rounded-lg transition"><i class="ph ph-download-simple text-xl"></i></button>
               </div>
               <div class="h-64 w-full">
                 <canvas id="revChart"></canvas>
               </div>
            </div>

            <!-- Live Intelligence Feed -->
            <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm flex flex-col">
               <div class="mb-4 flex items-center justify-between">
                 <div>
                   <h4 class="font-bold text-gray-800 text-lg">Regulatory Alerts</h4>
                   <p class="text-xs text-gray-400">Real-time situational awareness</p>
                 </div>
                 <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
               </div>
               <div class="flex-1 overflow-y-auto space-y-4 pr-2 max-h-[250px] custom-scrollbar">
                  <!-- Alert Item -->
                  <div class="flex gap-3 items-start border-l-2 border-red-500 pl-3">
                    <div>
                      <p class="text-xs font-bold text-gray-800">Unlicensed Billboard detected</p>
                      <p class="text-[10px] text-gray-500">Ikeja, Lagos • 12 mins ago</p>
                    </div>
                  </div>
                  <div class="flex gap-3 items-start border-l-2 border-yellow-500 pl-3">
                    <div>
                      <p class="text-xs font-bold text-gray-800">Compliance Rate Drop</p>
                      <p class="text-[10px] text-gray-500">Rivers State • 2 hours ago</p>
                    </div>
                  </div>
                  <div class="flex gap-3 items-start border-l-2 border-green-500 pl-3">
                    <div>
                      <p class="text-xs font-bold text-gray-800">New Agency Registration</p>
                      <p class="text-[10px] text-gray-500">Abuja FCT • 4 hours ago</p>
                    </div>
                  </div>
                   <div class="flex gap-3 items-start border-l-2 border-gray-300 pl-3">
                    <div>
                      <p class="text-xs font-bold text-gray-800">System Backup Complete</p>
                      <p class="text-[10px] text-gray-500">System • 6 hours ago</p>
                    </div>
                  </div>
               </div>
            </div>
          </div>
        </div>

        <!-- VIEW: AGENCIES -->
        <div id="view-agencies" class="hidden space-y-6 animate-fade-in pb-8">
           <!-- Header -->
           <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm flex flex-col md:flex-row justify-between items-center gap-4">
              <div>
                 <h2 class="text-xl font-bold text-gray-800">Agency Registry</h2>
                 <p class="text-sm text-gray-500">Monitor advertising practitioners and their portfolios.</p>
              </div>
              <div class="w-full md:w-auto relative">
                 <i class="ph ph-magnifying-glass absolute left-3 top-3 text-gray-400"></i>
                 <input type="text" id="agency-search" oninput="renderAgencies()" placeholder="Search Agency Name or RC..." class="pl-10 pr-4 py-2.5 border border-gray-200 rounded-xl text-sm w-full md:w-64 focus:ring-2 focus:ring-arconGreen/20 outline-none">
              </div>
           </div>

           <!-- Agencies Table -->
           <div class="bg-white rounded-3xl border border-gray-100 shadow-sm overflow-hidden">
              <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                   <thead class="bg-gray-50 text-gray-400 font-bold text-[11px] uppercase tracking-wider border-b border-gray-100">
                      <tr>
                        <th class="px-6 py-4">Agency Details</th>
                        <th class="px-6 py-4">RC Number</th>
                        <th class="px-6 py-4 text-center">Active Ads</th>
                        <th class="px-6 py-4 text-center">Compliance Score</th>
                        <th class="px-6 py-4 text-right">Action</th>
                      </tr>
                   </thead>
                   <tbody id="agencies-table-body" class="divide-y divide-gray-100">
                      <!-- Populated via JS -->
                   </tbody>
                </table>
              </div>
           </div>
        </div>

        <!-- VIEW: REPORTS (NEW) -->
        <div id="view-reports" class="hidden space-y-6 animate-fade-in pb-8">
          <!-- Header & Filters -->
          <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm flex flex-col md:flex-row justify-between items-center gap-4 sticky top-0 z-20 md:relative">
            <div>
              <h2 class="text-xl font-bold text-gray-800">Reports Center</h2>
              <p class="text-sm text-gray-500">Generate and export official regulatory documents.</p>
            </div>
            <div class="flex gap-1 bg-gray-50 p-1.5 rounded-xl border border-gray-100">
               <button onclick="setReportPeriod(this, 'Daily')" class="report-period-btn active px-4 py-2 bg-white text-arconGreen font-bold rounded-lg shadow-sm text-xs transition-all">Daily</button>
               <button onclick="setReportPeriod(this, 'Monthly')" class="report-period-btn px-4 py-2 text-gray-500 hover:text-gray-700 font-bold rounded-lg text-xs transition-all">Monthly</button>
               <button onclick="setReportPeriod(this, 'Yearly')" class="report-period-btn px-4 py-2 text-gray-500 hover:text-gray-700 font-bold rounded-lg text-xs transition-all">Yearly</button>
            </div>
          </div>

          <!-- Report Types Grid -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
             <!-- Executive Summary -->
             <div class="bg-green-gradient text-white p-6 rounded-3xl shadow-lg relative overflow-hidden group cursor-pointer hover:shadow-xl transition-all hover:scale-[1.02] border border-white/10" onclick="generateReport('Executive Summary')">
                <div class="absolute right-0 top-0 w-32 h-32 bg-white/10 rounded-bl-[100px] -mr-6 -mt-6 transition-transform group-hover:scale-110"></div>
                <div class="relative z-10">
                   <div class="w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center text-2xl mb-4 border border-white/20"><i class="ph ph-presentation-chart"></i></div>
                   <h3 class="text-lg font-bold">Executive Summary</h3>
                   <p class="text-xs text-green-100 mt-1 mb-6 opacity-80">High-level overview of all KPIs including revenue, compliance, and agency metrics.</p>
                   <button class="w-full py-3 bg-white text-arconGreen rounded-xl text-xs font-bold flex items-center justify-center gap-2 shadow-lg active:scale-95 transition-all">
                     <i class="ph ph-printer text-lg"></i> Generate PDF
                   </button>
                </div>
             </div>
             <!-- Financial -->
             <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm relative overflow-hidden group cursor-pointer hover:border-arconGreen hover:shadow-md transition-all" onclick="generateReport('Financial Report')">
                <div class="w-12 h-12 bg-green-50 text-arconGreen rounded-xl flex items-center justify-center text-2xl mb-4"><i class="ph ph-file-text"></i></div>
                <h3 class="text-lg font-bold text-gray-800">Financial Report</h3>
                <p class="text-xs text-gray-400 mt-1 mb-6">Detailed revenue breakdown, collections, and future projections.</p>
                <button class="w-full py-3 bg-gray-50 hover:bg-gray-100 rounded-xl text-xs font-bold text-gray-600 flex items-center justify-center gap-2 transition-colors">
                   <i class="ph ph-download-simple text-lg"></i> Download
                </button>
             </div>
             <!-- Compliance -->
             <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm relative overflow-hidden group cursor-pointer hover:border-red-500 hover:shadow-md transition-all" onclick="generateReport('Enforcement Log')">
                <div class="w-12 h-12 bg-red-50 text-red-600 rounded-xl flex items-center justify-center text-2xl mb-4"><i class="ph ph-warning-octagon"></i></div>
                <h3 class="text-lg font-bold text-gray-800">Enforcement Log</h3>
                <p class="text-xs text-gray-400 mt-1 mb-6">List of violations, pending actions, and resolved compliance cases.</p>
                <button class="w-full py-3 bg-gray-50 hover:bg-gray-100 rounded-xl text-xs font-bold text-gray-600 flex items-center justify-center gap-2 transition-colors">
                   <i class="ph ph-download-simple text-lg"></i> Download
                </button>
             </div>
          </div>

          <!-- Recent Reports Table -->
          <div class="bg-white rounded-3xl border border-gray-100 shadow-sm overflow-hidden">
             <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50/50">
                <h3 class="font-bold text-gray-800 text-sm md:text-base">Recent Activity</h3>
                <span class="text-xs text-gray-400 font-medium">Auto-archived for 90 days</span>
             </div>
             <div class="overflow-x-auto">
               <table class="w-full text-left text-sm">
                  <thead class="bg-gray-50 text-gray-400 font-bold text-[11px] uppercase tracking-wider">
                     <tr>
                        <th class="px-6 py-4">Report Name</th>
                        <th class="px-6 py-4">Date Generated</th>
                        <th class="px-6 py-4">Type</th>
                        <th class="px-6 py-4 text-right">Action</th>
                     </tr>
                  </thead>
                  <tbody id="report-history-body" class="divide-y divide-gray-100">
                     <!-- Populated by JS -->
                  </tbody>
               </table>
             </div>
          </div>
        </div>

        <!-- VIEW: MAP -->
        <div id="view-map" class="hidden h-[75vh] md:h-full flex flex-col bg-white rounded-3xl border border-gray-200 shadow-sm overflow-hidden relative animate-fade-in">
           <!-- Map Header Overlay -->
           <div class="absolute top-4 left-4 right-4 z-[400] flex justify-between items-start pointer-events-none">
              <div class="bg-white/95 backdrop-blur rounded-2xl shadow-xl border border-gray-100 p-4 pointer-events-auto">
                 <h3 class="font-bold text-gray-800 text-sm flex items-center gap-2"><i class="ph ph-globe text-arconGreen"></i> National Compliance Map</h3>
                 <p class="text-[10px] text-gray-400 mt-1">Live feed from zonal offices</p>
              </div>
              <div class="bg-white/95 backdrop-blur rounded-full px-4 py-2 shadow-xl border border-gray-100 text-xs font-bold flex gap-4 pointer-events-auto">
                 <span class="flex items-center gap-1.5"><span class="w-2.5 h-2.5 rounded-full bg-arconGreen shadow-sm shadow-green-500/50"></span> Compliant</span>
                 <span class="flex items-center gap-1.5"><span class="w-2.5 h-2.5 rounded-full bg-red-500 shadow-sm shadow-red-500/50"></span> Illegal/Expired</span>
              </div>
           </div>
           <div id="map-dg" class="flex-grow w-full bg-slate-100 z-0"></div>
        </div>

      </div>
    </main>

    <!-- LOADING TOAST -->
    <div id="toast-loading" class="fixed bottom-24 right-6 bg-gray-900 text-white px-6 py-4 rounded-xl shadow-2xl z-50 flex items-center gap-3 hidden animate-slide-up">
       <div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
       <div>
         <p class="font-bold text-sm">Generating Report...</p>
         <p class="text-xs text-gray-400">Please wait while we compile data.</p>
       </div>
    </div>

    <!-- AGENCY DETAIL MODAL -->
    <div id="agency-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
       <div class="bg-white w-full max-w-2xl rounded-3xl shadow-2xl overflow-hidden animate-slide-up max-h-[85vh] flex flex-col">
          <div class="p-6 border-b border-gray-100 bg-gray-50 flex justify-between items-center">
             <div>
                <h3 class="font-bold text-xl text-gray-900" id="modal-agency-name">--</h3>
                <p class="text-xs text-gray-500 font-mono" id="modal-agency-rc">RC: --</p>
             </div>
             <button onclick="document.getElementById('agency-modal').classList.add('hidden')" class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300"><i class="ph ph-x"></i></button>
          </div>
          <div class="p-6 overflow-y-auto">
             <div class="flex gap-4 mb-6">
                <div class="flex-1 bg-green-50 p-4 rounded-2xl border border-green-100">
                   <p class="text-xs font-bold text-green-700 uppercase">Running Ads</p>
                   <h4 class="text-2xl font-black text-green-900" id="modal-agency-ads">0</h4>
                </div>
                <div class="flex-1 bg-blue-50 p-4 rounded-2xl border border-blue-100">
                   <p class="text-xs font-bold text-blue-700 uppercase">APCON ID</p>
                   <h4 class="text-lg font-bold text-blue-900" id="modal-agency-id">--</h4>
                </div>
             </div>
             <h4 class="font-bold text-gray-800 mb-3 text-sm border-b pb-2">Active Campaigns</h4>
             <ul class="space-y-3" id="modal-campaign-list">
                <!-- Populated JS -->
             </ul>
          </div>
       </div>
    </div>

  </div>

  <script>
    // --- Data ---
    const NIGERIA_DATA = [
      { state: "Abuja FCT", lgas: ["Abaji", "Abuja Municipal", "Bwari", "Gwagwalada", "Kuje", "Kwali"] },
      { state: "Lagos", lgas: ["Ikeja", "Lagos Island", "Eti-Osa", "Surulere", "Alimosho"] },
      { state: "Rivers", lgas: ["Port Harcourt", "Obio-Akpor", "Ikwerre", "Eleme"] },
      { state: "Kano", lgas: ["Kano Municipal", "Fagge", "Dala", "Nassarawa"] }
    ];

    const AGENCIES = [
      { name: "Insight Publicis", rc: "RC123456", id: "APCON/001", ads: 45, score: 98, campaigns: ["Glo Unlimited", "Pepsi Naija", "Heineken UEFA"] },
      { name: "X3M Ideas", rc: "RC987654", id: "APCON/042", ads: 32, score: 95, campaigns: ["DSTV Premium", "Access Bank Marathon"] },
      { name: "Noah's Ark", rc: "RC456789", id: "APCON/015", ads: 28, score: 92, campaigns: ["Airtel 4G", "Indomie Noodles"] },
      { name: "DDB Lagos", rc: "RC112233", id: "APCON/008", ads: 40, score: 96, campaigns: ["MTN 5G", "Fidelity Bank"] },
      { name: "Yellow Brick Road", rc: "RC554433", id: "APCON/102", ads: 12, score: 88, campaigns: ["First Bank Centenary"] },
      { name: "MediaReach OMD", rc: "RC778899", id: "APCON/055", ads: 55, score: 99, campaigns: ["Guinness Gold", "Nestle Milo", "Omo Detergent"] }
    ];

    let mapInstance = null;
    let revChart = null;
    let currentReportPeriod = 'Daily';

    // --- Core Logic ---
    function init() {
      populateStates();
      setView('overview');
      initCharts();
      renderAgencies();
      renderReportHistory();
    }

    function setView(viewId) {
      ['overview', 'agencies', 'reports', 'map'].forEach(v => document.getElementById('view-'+v).classList.add('hidden'));
      document.getElementById('view-'+viewId).classList.remove('hidden');
      
      // Update Nav States
      document.querySelectorAll('.desktop-nav-btn, .mobile-nav-btn').forEach(el => {
         el.classList.remove('text-arconGreen', 'bg-white', 'shadow-lg');
         if(el.classList.contains('desktop-nav-btn')) el.classList.add('text-white/80', 'hover:bg-white/10');
         else el.classList.add('text-gray-400');
      });

      // Highlight Active
      const dBtn = document.querySelector(`.desktop-nav-btn[onclick*="${viewId}"]`);
      if(dBtn) {
         dBtn.classList.remove('text-white/80', 'hover:bg-white/10');
         dBtn.classList.add('bg-white', 'text-arconGreen', 'shadow-lg');
      }
      
      const mBtn = document.getElementById('mob-nav-'+viewId);
      if(mBtn) {
         mBtn.classList.remove('text-gray-400');
         mBtn.classList.add('text-arconGreen');
      }

      document.getElementById('page-title').innerText = viewId.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
      if(viewId === 'map') setTimeout(initMap, 200);
    }

    // --- Filters ---
    function populateStates() {
      const sel = document.getElementById('filter-state');
      NIGERIA_DATA.forEach(s => {
         let opt = document.createElement('option');
         opt.value = s.state; opt.innerText = s.state;
         sel.appendChild(opt);
      });
    }

    function populateLgas() {
       const stateVal = document.getElementById('filter-state').value;
       const lgaSel = document.getElementById('filter-lga');
       lgaSel.innerHTML = '<option value="all">All LGAs</option>';
       
       const stateData = NIGERIA_DATA.find(s => s.state === stateVal);
       if(stateData) {
         stateData.lgas.forEach(l => {
            let opt = document.createElement('option');
            opt.value = l; opt.innerText = l;
            lgaSel.appendChild(opt);
         });
       }
    }

    function applyFilters() {
       const state = document.getElementById('filter-state').value;
       alert(`Refreshing Dashboard Data for ${state === 'all' ? 'National View' : state}...`);
    }

    // --- Agencies Module ---
    function renderAgencies() {
       const search = document.getElementById('agency-search').value.toLowerCase();
       const tbody = document.getElementById('agencies-table-body');
       tbody.innerHTML = '';

       AGENCIES.filter(a => a.name.toLowerCase().includes(search) || a.rc.toLowerCase().includes(search)).forEach(agency => {
          const row = `
             <tr class="hover:bg-slate-50 border-b border-gray-50 transition cursor-pointer" onclick="showAgencyModal('${agency.name}')">
                <td class="px-6 py-4 font-bold text-gray-800">${agency.name}</td>
                <td class="px-6 py-4 font-mono text-gray-500 text-xs">${agency.rc}</td>
                <td class="px-6 py-4 text-center"><span class="bg-blue-50 text-blue-700 px-2 py-1 rounded-lg text-xs font-bold">${agency.ads} Active</span></td>
                <td class="px-6 py-4 text-center">
                   <div class="w-full bg-gray-100 rounded-full h-2 w-24 mx-auto">
                      <div class="bg-green-500 h-2 rounded-full" style="width: ${agency.score}%"></div>
                   </div>
                   <span class="text-[10px] text-gray-400 font-bold mt-1 block">${agency.score}%</span>
                </td>
                <td class="px-6 py-4 text-right">
                   <button class="text-gray-400 hover:text-arconGreen"><i class="ph ph-caret-right text-lg"></i></button>
                </td>
             </tr>
          `;
          tbody.insertAdjacentHTML('beforeend', row);
       });
    }

    function showAgencyModal(name) {
       const agency = AGENCIES.find(a => a.name === name);
       if(!agency) return;

       document.getElementById('modal-agency-name').innerText = agency.name;
       document.getElementById('modal-agency-rc').innerText = `RC: ${agency.rc}`;
       document.getElementById('modal-agency-id').innerText = agency.id;
       document.getElementById('modal-agency-ads').innerText = agency.ads;

       const list = document.getElementById('modal-campaign-list');
       list.innerHTML = agency.campaigns.map(c => `
          <li class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl border border-gray-100">
             <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center shadow-sm text-arconGreen"><i class="ph ph-megaphone-simple"></i></div>
             <div><p class="text-sm font-bold text-gray-800">${c}</p><p class="text-[10px] text-green-600 font-bold">● Running</p></div>
          </li>
       `).join('');

       document.getElementById('agency-modal').classList.remove('hidden');
    }

    // --- Reports Module ---
    const MOCK_REPORTS = [
       { name: "Executive Summary - Q3", date: "2025-10-01", type: "Executive Summary" },
       { name: "Financial Audit Oct", date: "2025-10-05", type: "Financial Report" }
    ];

    function renderReportHistory() {
       const tbody = document.getElementById('report-history-body');
       tbody.innerHTML = '';
       MOCK_REPORTS.forEach(r => {
          const row = `
             <tr class="hover:bg-slate-50 border-b border-gray-50 transition">
                <td class="px-6 py-4 font-bold text-gray-800 flex items-center gap-2">
                   <i class="ph ph-file-pdf text-red-500 text-lg"></i> ${r.name}
                </td>
                <td class="px-6 py-4 text-gray-500 text-xs">${r.date}</td>
                <td class="px-6 py-4"><span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs font-bold">${r.type}</span></td>
                <td class="px-6 py-4 text-right">
                   <button onclick="alert('Downloading ${r.name}...')" class="text-arconGreen font-bold text-xs hover:underline">Download</button>
                </td>
             </tr>
          `;
          tbody.insertAdjacentHTML('afterbegin', row);
       });
    }

    function setReportPeriod(btn, period) {
       document.querySelectorAll('.report-period-btn').forEach(b => {
          b.classList.remove('bg-white', 'text-arconGreen', 'shadow-sm');
          b.classList.add('text-gray-500');
       });
       btn.classList.add('bg-white', 'text-arconGreen', 'shadow-sm');
       btn.classList.remove('text-gray-500');
       currentReportPeriod = period;
    }

    function generateReport(type) {
       const toast = document.getElementById('toast-loading');
       toast.classList.remove('hidden');
       
       setTimeout(() => {
          toast.classList.add('hidden');
          const today = new Date().toISOString().slice(0,10);
          MOCK_REPORTS.push({ 
             name: `${type} - ${currentReportPeriod} (${today})`, 
             date: today, 
             type: type 
          });
          renderReportHistory();
          if(type === 'Executive Summary') {
             window.print(); // Simple print trigger for demo
          } else {
             alert(`${type} generated successfully! Added to history.`);
          }
       }, 2000);
    }

    // --- Visuals ---
    function initMap() {
      if(mapInstance) { mapInstance.invalidateSize(); return; }
      mapInstance = L.map('map-dg').setView([9.0820, 8.6753], 6);
      L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', { attribution: '&copy; OSM' }).addTo(mapInstance);
      
      const style = { color: '#008751', fillColor: '#008751', fillOpacity: 0.6, radius: 6, weight: 1, color: 'white' };
      L.circleMarker([9.07, 7.39], style).addTo(mapInstance);
      L.circleMarker([6.52, 3.37], style).addTo(mapInstance);
    }

    function initCharts() {
       const ctx = document.getElementById('revChart').getContext('2d');
       const grad = ctx.createLinearGradient(0,0,0,300);
       grad.addColorStop(0, 'rgba(0, 135, 81, 0.15)');
       grad.addColorStop(1, 'rgba(0, 135, 81, 0)');

       new Chart(ctx, {
          type: 'line',
          data: {
             labels: ['Jan','Feb','Mar','Apr','May','Jun'],
             datasets: [{
                label: 'Revenue', data: [15, 22, 18, 30, 28, 45.2],
                borderColor: '#008751', backgroundColor: grad, fill: true, tension: 0.4
             }]
          },
          options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
       });
    }

    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
