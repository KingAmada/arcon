<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>ARCON | Advertising Regulatory Council of Nigeria</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <script src="https://unpkg.com/@phosphor-icons/web"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            arconGreen: "#008751",
            arconGreenDark: "#00643C",
            arconYellow: "#F5A800",
            ink: "#0B1220",
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            serif: ['Merriweather', 'serif'],
            mono: ['Fira Code', 'monospace'],
          },
          screens: {
            'print': {'raw': 'print'},
          }
        }
      }
    }
  </script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Merriweather:wght@400;700;900&family=Fira+Code:wght@400;600&display=swap');
    
    body { font-family: Inter, system-ui, sans-serif; background:#f8fafc; -webkit-tap-highlight-color: transparent; }
    
    .hero-bg {
      background-image: linear-gradient(rgba(0, 135, 81, 0.95), rgba(0, 70, 40, 0.95)), url('https://images.unsplash.com/photo-1572061486895-3c8e76c27f31?q=80&w=2070');
      background-size: cover; background-position: center;
    }

    /* TOAST ANIMATION */
    @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
    .toast-enter { animation: slideIn 0.5s forwards; }
    .toast-exit { animation: fadeOut 0.5s forwards; }

    /* PRINT STYLES - FIXED FOR CERTIFICATE */
    @media print {
      @page { margin: 0; size: A4; }
      body { background: white; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      
      /* Hide everything except certificate */
      body > *:not(#certificate-modal) { display: none !important; }
      
      #certificate-modal { 
        position: fixed !important; top: 0 !important; left: 0 !important; 
        width: 100vw !important; height: 100vh !important; 
        background: white !important; z-index: 99999 !important; 
        overflow: hidden !important; padding: 0 !important; display: block !important;
      }

      #certificate-container {
        box-shadow: none !important; margin: 0 !important; width: 100% !important; max-width: none !important;
        transform: scale(0.95); transform-origin: top center; /* Shrink slightly to fit margins */
      }

      /* Buttons & Close icons hidden */
      .no-print { display: none !important; }
      
      /* Ensure Grid holds structure */
      .print-grid-fix { display: grid !important; grid-template-columns: repeat(5, 1fr) !important; }
      .print-col-span-4 { grid-column: span 4 / span 4 !important; }
      .print-col-span-1 { grid-column: span 1 / span 1 !important; }
    }
  </style>
</head>

<body class="flex flex-col min-h-screen text-ink">

  <div id="toast-container" class="fixed top-20 right-4 z-[100] flex flex-col gap-2 pointer-events-none no-print"></div>

  <header class="bg-white border-b border-gray-200 sticky top-0 z-40 no-print">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16 items-center">
        <div class="flex items-center gap-3 cursor-pointer" onclick="goHome()">
          <img src="https://raw.githubusercontent.com/KingAmada/arcon/refs/heads/main/arcon.jpg" class="h-10 w-10 rounded shadow-sm">
          <div class="leading-tight">
            <h1 class="font-serif font-black text-arconGreenDark text-lg tracking-tight">ARCON</h1>
            <p class="text-[9px] text-gray-500 uppercase tracking-widest font-extrabold hidden sm:block">Integrated Regulatory Platform</p>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <button onclick="openVerifyModal()" class="hidden md:flex items-center gap-2 text-sm font-bold text-gray-600 hover:text-arconGreen">
            <i class="ph ph-scan text-lg"></i> Verify
          </button>

          <div id="auth-buttons" class="flex items-center gap-2">
            <button onclick="openAuthModal('signin')" class="text-sm font-bold text-gray-600 px-3 py-2">Sign In</button>
            <button onclick="openAuthModal('signup')" class="bg-arconGreen text-white px-4 py-2 rounded-lg text-sm font-bold shadow hover:bg-arconGreenDark transition">Register</button>
          </div>

          <div id="user-menu" class="hidden items-center gap-3">
             <div class="text-right hidden sm:block">
              <span class="block text-xs font-bold text-gray-800" id="user-name-display">User</span>
              <span class="block text-[10px] text-gray-400" id="user-type-display">Agency</span>
            </div>
            <div class="h-8 w-8 bg-arconGreenDark text-white rounded-full flex items-center justify-center font-bold text-xs" id="avatar-badge">AG</div>
            <button onclick="doLogout()" class="text-red-500 p-2"><i class="ph ph-sign-out text-lg"></i></button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main id="view-landing" class="flex-grow flex flex-col">
    <section class="hero-bg py-16 px-4 text-center text-white relative overflow-hidden">
      <div class="absolute top-0 left-0 w-full h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
      
      <div class="relative z-10 max-w-4xl mx-auto space-y-6">
        <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur-md px-3 py-1 rounded-full border border-white/20 text-[10px] font-bold uppercase tracking-wider text-green-100">
          <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span> Enforcement Active
        </div>

        <h1 class="text-3xl md:text-5xl font-serif font-black leading-tight drop-shadow-md">
          Advertising Regulatory <br/> Council of Nigeria
        </h1>

        <p class="text-green-50 text-sm md:text-lg max-w-xl mx-auto leading-relaxed">
          Ensure your brand is safe. Unvetted advertisements are subject to immediate removal and regulatory fines.
        </p>

        <div class="flex flex-col sm:flex-row gap-4 justify-center mt-6">
          <button onclick="openAuthModal('signup')" class="bg-arconYellow hover:bg-arconYellowDark text-ink px-8 py-4 rounded-xl font-black text-lg shadow-xl flex items-center justify-center gap-2 transform active:scale-95 transition">
            Get Licensed <i class="ph ph-arrow-right-bold"></i>
          </button>
          <button onclick="openVerifyModal()" class="bg-white text-gray-900 px-8 py-4 rounded-xl font-black text-lg shadow-xl flex items-center justify-center gap-2 transform active:scale-95 transition">
            <i class="ph ph-scan text-arconGreen text-xl"></i> Verify Asset
          </button>
        </div>
      </div>
    </section>

    <section class="bg-ink text-white py-10 px-4">
      <div class="max-w-6xl mx-auto">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 text-center border-b border-gray-800 pb-8 mb-8">
          <div>
            <div class="text-3xl font-black text-arconYellow">50k+</div>
            <div class="text-xs text-gray-400 uppercase tracking-widest mt-1">Assets Vetted</div>
          </div>
          <div>
            <div class="text-3xl font-black text-green-400">24h</div>
            <div class="text-xs text-gray-400 uppercase tracking-widest mt-1">Approval Time</div>
          </div>
          <div>
            <div class="text-3xl font-black text-red-500">₦500k</div>
            <div class="text-xs text-gray-400 uppercase tracking-widest mt-1">Fine for Illegal Ads</div>
          </div>
          <div>
            <div class="text-3xl font-black text-blue-400">100%</div>
            <div class="text-xs text-gray-400 uppercase tracking-widest mt-1">Compliance</div>
          </div>
        </div>
        
        <div class="flex flex-col md:flex-row items-center justify-between gap-6 bg-gray-900 p-6 rounded-2xl border border-gray-800">
          <div class="flex items-start gap-4">
            <div class="bg-red-500/20 p-3 rounded-full text-red-500"><i class="ph ph-warning-octagon text-2xl"></i></div>
            <div>
              <h3 class="font-bold text-lg text-white">Don't Risk Your Brand Reputation</h3>
              <p class="text-sm text-gray-400">Illegal advertisements are removed daily. Secure your APCON Certificate of Approval today.</p>
            </div>
          </div>
          <button onclick="openAuthModal('signin')" class="w-full md:w-auto px-6 py-3 rounded-lg bg-white text-ink font-black text-sm whitespace-nowrap">Login to Portal</button>
        </div>
      </div>
    </section>
  </main>

  <main id="view-dashboard" class="hidden flex-grow bg-gray-50 flex flex-col md:flex-row h-[calc(100vh-64px)] overflow-hidden">
    <aside class="w-full md:w-20 lg:w-64 bg-white border-r border-gray-200 flex-shrink-0 flex flex-row md:flex-col justify-between md:justify-start z-30 no-print">
      <nav class="p-2 md:p-4 flex md:flex-col gap-1 w-full overflow-x-auto md:overflow-visible">
        <button onclick="dashSwitch('overview')" id="nav-overview" class="flex-1 md:flex-none text-left px-3 py-3 rounded-lg text-xs md:text-sm font-bold flex flex-col md:flex-row items-center gap-2 md:gap-3 bg-green-50 text-arconGreen">
          <i class="ph ph-squares-four text-xl"></i> <span class="hidden md:inline">Overview</span>
        </button>
        <button onclick="dashSwitch('apply')" id="nav-apply" class="flex-1 md:flex-none text-left px-3 py-3 rounded-lg text-xs md:text-sm font-bold flex flex-col md:flex-row items-center gap-2 md:gap-3 text-gray-600 hover:bg-gray-50">
          <i class="ph ph-plus-circle text-xl"></i> <span class="hidden md:inline">New Application</span>
        </button>
        <button onclick="dashSwitch('assets')" id="nav-assets" class="flex-1 md:flex-none text-left px-3 py-3 rounded-lg text-xs md:text-sm font-bold flex flex-col md:flex-row items-center gap-2 md:gap-3 text-gray-600 hover:bg-gray-50">
          <i class="ph ph-files text-xl"></i> <span class="hidden md:inline">My Assets</span>
        </button>
      </nav>
    </aside>

    <div class="flex-grow overflow-y-auto p-4 md:p-8 relative">
      <div id="dash-overview" class="space-y-6 max-w-6xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
          <div>
            <h2 class="text-2xl font-serif font-black text-gray-800">Overview</h2>
            <p class="text-xs text-gray-500">Compliance Status</p>
          </div>
          <button onclick="dashSwitch('apply')" class="w-full md:w-auto bg-arconGreen text-white px-6 py-3 rounded-xl text-sm font-bold shadow-lg hover:bg-arconGreenDark active:scale-95 transition">
            + New Application
          </button>
        </div>

        <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6">
          <div class="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100">
            <div class="text-2xl font-black text-arconGreen" id="stat-active">0</div>
            <div class="text-xs text-gray-500 font-bold uppercase">Active Licenses</div>
          </div>
          <div class="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100">
             <div class="text-2xl font-black text-arconYellowDark" id="stat-expiring">0</div>
             <div class="text-xs text-gray-500 font-bold uppercase">Expiring Soon</div>
          </div>
          <div class="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100">
             <div class="text-2xl font-black text-gray-700" id="stat-pending">0</div>
             <div class="text-xs text-gray-500 font-bold uppercase">Pending</div>
          </div>
          <div class="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100">
             <div class="text-2xl font-black text-ink" id="stat-total">0</div>
             <div class="text-xs text-gray-500 font-bold uppercase">Total Assets</div>
          </div>
        </div>
      </div>

      <div id="dash-apply" class="hidden max-w-3xl mx-auto pb-20">
        <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
          <div class="bg-arconGreenDark text-white p-5">
            <h3 class="text-lg font-black">New License Application</h3>
          </div>
          
          <form id="application-form" onsubmit="handleFormSubmit(event)" class="p-5 md:p-8 space-y-8">
            <div class="space-y-4">
               <h4 class="text-xs font-black text-arconGreen uppercase border-b pb-1">1. Agency Details (Auto-Filled)</h4>
               <div class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-50 p-4 rounded-xl border border-gray-100">
                 <div class="md:col-span-2">
                   <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Agency Name</label>
                   <input id="agency-name" required class="w-full p-2 bg-white border rounded text-sm font-bold text-gray-700">
                 </div>
                 <div>
                   <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">RC Number (Required)</label>
                   <input id="agency-rc" required placeholder="e.g. RC123456" class="w-full p-2 bg-white border border-gray-300 rounded text-sm focus:border-arconGreen outline-none">
                 </div>
                 <div>
                   <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Phone</label>
                   <input id="agency-phone" required class="w-full p-2 bg-white border rounded text-sm text-gray-700">
                 </div>
               </div>
            </div>

            <div class="space-y-4">
              <h4 class="text-xs font-black text-arconGreen uppercase border-b pb-1">2. Ad Content & Location</h4>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                 <div>
                  <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Advert Category</label>
                  <select id="industry" onchange="calcFee()" class="w-full p-3 border rounded-lg bg-white text-sm outline-none focus:ring-1 focus:ring-arconGreen" required>
                    <option value="">Select Category</option>
                    <option value="Corporate Branding">Corporate Branding</option>
                    <option value="New Product Launch">New Product Launch</option>
                    <option value="Religious Program / Crusade">Religious Program / Crusade</option>
                    <option value="Election Campaign / Political">Election Campaign / Political</option>
                    <option value="SME / Small Business">SME / Small Business</option>
                  </select>
                </div>
                <div>
                  <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Sponsor Name (Client)</label>
                  <input type="text" id="sponsor" placeholder="e.g. Coca-Cola" required class="w-full p-3 border rounded-lg text-sm outline-none focus:ring-1 focus:ring-arconGreen">
                </div>
                
                <div class="md:col-span-2">
                   <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Board Owner</label>
                   <select id="board-owner-mode" class="w-full p-3 border rounded-lg bg-white text-sm" required>
                     <option value="self">Same as Agency (Logged In User)</option>
                     <option value="sponsor">Same as Sponsor</option>
                   </select>
                </div>

                <div>
                   <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Media Type</label>
                   <select id="ad-type" class="w-full p-3 border rounded-lg bg-white text-sm" required>
                     <option value="Static Billboard">Static Billboard</option>
                     <option value="Digital LED Billboard">Digital LED Billboard</option>
                     <option value="Unipole">Unipole</option>
                     <option value="Street Lamp Post">Street Lamp Post</option>
                   </select>
                </div>
                <div>
                  <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Size</label>
                  <select id="size" onchange="calcFee()" class="w-full p-3 border rounded-lg bg-white text-sm" required>
                    <option value="48-Sheet (Standard Billboard 6m x 3m)">48-Sheet (Standard Billboard)</option>
                    <option value="Unipole (18m x 6m)">Unipole (18m x 6m)</option>
                    <option value="Gantry (20m x 4m)">Gantry (20m x 4m)</option>
                  </select>
                </div>

                <div>
                   <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">State</label>
                   <select id="state" class="w-full p-3 border rounded-lg bg-white text-sm" required onchange="calcFee()">
                     <option value="Lagos">Lagos</option>
                     <option value="Abuja FCT">Abuja FCT</option>
                     <option value="Kano">Kano</option>
                     <option value="Rivers">Rivers</option>
                     <option value="Enugu">Enugu</option>
                   </select>
                </div>

                <div>
                  <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Duration (Months)</label>
                  <input type="number" id="dur-val" value="1" min="1" class="w-full p-3 border rounded-lg text-sm" oninput="calcFee()">
                </div>
              </div>
            </div>

            <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center cursor-pointer hover:bg-gray-50">
              <input type="file" id="media" multiple accept="image/*" class="hidden" onchange="previewMedia(this)">
              <label for="media" class="cursor-pointer block">
                <i class="ph ph-upload-simple text-2xl text-arconGreen"></i>
                <p class="text-xs font-bold text-gray-500 mt-2">Tap to upload Visuals (Images)</p>
              </label>
              <div id="media-preview" class="flex gap-2 justify-center mt-4 flex-wrap"></div>
            </div>

            <div class="bg-gray-900 text-white p-4 rounded-xl flex items-center justify-between sticky bottom-4 shadow-xl">
              <div>
                <p class="text-[10px] text-gray-400 uppercase">Total Fee</p>
                <h3 id="fee-display" class="text-2xl font-black">₦0.00</h3>
              </div>
              <button type="submit" class="bg-arconGreen px-6 py-2 rounded-lg font-bold text-sm hover:bg-green-500">
                Proceed
              </button>
            </div>
          </form>
        </div>
      </div>

      <div id="dash-assets" class="hidden space-y-4 max-w-6xl mx-auto">
        <h2 class="text-xl font-bold text-gray-800">My Assets</h2>
        <div id="assets-container" class="space-y-4">
           <div class="text-center py-10 text-gray-400">No assets found. Create an application.</div>
        </div>
      </div>
    </div>
  </main>

  <div id="auth-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/80 backdrop-blur-sm p-4">
    <div class="bg-white w-full max-w-sm rounded-2xl overflow-hidden shadow-2xl">
       <div class="flex text-center border-b font-bold text-xs">
        <button onclick="switchAuth('signin')" id="tab-signin" class="flex-1 py-4 bg-white text-arconGreen">Sign In</button>
        <button onclick="switchAuth('signup')" id="tab-signup" class="flex-1 py-4 bg-gray-50 text-gray-500">Register</button>
      </div>
      <div class="p-6 space-y-4">
         <div id="form-signin">
            <input type="email" id="login-email" value="micro@press.com" class="w-full p-3 border rounded-lg text-sm mb-3" placeholder="Email">
            <button onclick="doLogin()" class="w-full bg-arconGreen text-white py-3 rounded-lg font-black text-sm">Login</button>
         </div>
         <div id="form-signup" class="hidden space-y-3">
            <input type="text" id="reg-name" placeholder="Agency Name" class="w-full p-3 border rounded-lg text-sm">
            <input type="text" id="reg-rc" placeholder="RC Number" class="w-full p-3 border rounded-lg text-sm">
            <button onclick="doLogin()" class="w-full bg-ink text-white py-3 rounded-lg font-black text-sm">Register</button>
         </div>
      </div>
       <button onclick="closeModal('auth-modal')" class="w-full py-3 text-xs text-gray-500">Cancel</button>
    </div>
  </div>

  <div id="verify-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/90 backdrop-blur-md p-4">
    <div class="bg-white w-full max-w-sm rounded-2xl overflow-hidden relative flex flex-col max-h-[90vh]">
      <button onclick="closeVerifyModal()" class="absolute top-3 right-3 z-10 bg-gray-100 rounded-full p-2 text-gray-600"><i class="ph ph-x"></i></button>
      
      <div class="p-5 text-center flex-shrink-0">
        <h3 class="font-black text-lg text-gray-800">Verify Compliance</h3>
        <p class="text-xs text-gray-500 mt-1">Scan QR or Enter License ID</p>
      </div>

      <div class="flex-grow overflow-y-auto px-5 pb-5">
        <div id="reader" class="w-full aspect-square bg-black rounded-xl overflow-hidden mb-4 relative">
          <div class="absolute inset-0 flex items-center justify-center text-gray-500 text-xs pointer-events-none">Camera Inactive</div>
        </div>

        <div class="flex gap-2 mb-4">
          <button onclick="startScanner()" class="flex-1 bg-arconGreen text-white py-2 rounded-lg text-xs font-bold">Start Camera</button>
          <button onclick="stopScanner()" class="flex-1 bg-gray-100 text-gray-800 py-2 rounded-lg text-xs font-bold">Stop</button>
        </div>

        <div class="border-t pt-4">
          <input type="text" id="verify-input" placeholder="APP-2025-XXXX" class="w-full text-center p-3 border rounded-lg font-mono font-bold uppercase mb-2">
          <button onclick="performVerify()" class="w-full bg-ink text-white py-3 rounded-lg font-bold text-sm">Check Status</button>
        </div>

        <div id="verify-result" class="mt-4 hidden p-3 rounded-lg bg-gray-50 border text-sm"></div>
      </div>
    </div>
  </div>

  <div id="certificate-modal" class="hidden fixed inset-0 z-[60] bg-black/90 p-2 md:p-4 overflow-y-auto items-center justify-center flex">
    <div id="certificate-container" class="bg-white w-full max-w-[210mm] relative shadow-2xl mx-auto origin-top">
      
      <button onclick="closeModal('certificate-modal')" class="absolute -top-10 right-0 text-white font-bold flex gap-2 items-center no-print">
        Close <i class="ph ph-x-circle text-2xl"></i>
      </button>

      <div class="p-8 md:p-12 border-[10px] border-double border-arconGreen relative overflow-hidden bg-white min-h-[297mm] flex flex-col justify-between">
        
        <div class="absolute inset-0 flex items-center justify-center opacity-[0.04] pointer-events-none">
           <img src="https://raw.githubusercontent.com/KingAmada/arcon/refs/heads/main/arcon.jpg" class="w-96 grayscale">
        </div>

        <div class="absolute top-0 left-0 w-20 h-20 border-t-4 border-l-4 border-arconYellow m-2"></div>
        <div class="absolute bottom-0 right-0 w-20 h-20 border-b-4 border-r-4 border-arconYellow m-2"></div>

        <div class="text-center relative z-10">
          <img src="https://raw.githubusercontent.com/KingAmada/arcon/refs/heads/main/arcon.jpg" class="h-16 mx-auto mb-2">
          <h2 class="text-xl md:text-2xl font-serif font-black text-arconGreenDark">FEDERAL REPUBLIC OF NIGERIA</h2>
          <p class="text-[10px] font-black uppercase tracking-[0.3em] text-gray-600">Advertising Regulatory Council of Nigeria</p>
          
          <div class="border-t border-b border-arconYellow py-3 my-6">
            <h1 class="text-3xl md:text-5xl font-serif font-black text-ink">CERTIFICATE OF APPROVAL</h1>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-x-8 gap-y-4 text-sm font-serif relative z-10">
           <div class="border-b border-gray-100 pb-1">
             <span class="block text-[10px] font-sans font-bold text-gray-400 uppercase">License Number</span>
             <span id="c-id" class="font-black text-lg">APP-0000</span>
           </div>
           <div class="border-b border-gray-100 pb-1">
             <span class="block text-[10px] font-sans font-bold text-gray-400 uppercase">Issue Date</span>
             <span id="c-issue" class="font-bold">2025-12-13</span>
           </div>
           <div class="border-b border-gray-100 pb-1">
             <span class="block text-[10px] font-sans font-bold text-gray-400 uppercase">Sponsor</span>
             <span id="c-sponsor" class="font-bold">Name</span>
           </div>
           <div class="border-b border-gray-100 pb-1">
             <span class="block text-[10px] font-sans font-bold text-gray-400 uppercase">Category</span>
             <span id="c-cat" class="font-bold">Category</span>
           </div>
           <div class="border-b border-gray-100 pb-1 col-span-2">
             <span class="block text-[10px] font-sans font-bold text-gray-400 uppercase">Location</span>
             <span id="c-loc" class="font-bold">Lagos</span>
           </div>
        </div>

        <div class="mt-6 border border-gray-200 rounded-lg overflow-hidden relative z-10">
          <div class="bg-arconGreenDark text-white px-3 py-1 text-[10px] font-black uppercase tracking-widest">Advertising Company (Agency)</div>
          <div class="p-3 text-sm grid grid-cols-2 gap-2">
            <div><span class="font-bold">Name:</span> <span id="c-ag-name">Micro Press</span></div>
            <div><span class="font-bold">RC No:</span> <span id="c-ag-rc">RC123</span></div>
          </div>
        </div>

        <div class="mt-8 relative z-10">
          <p class="text-[10px] font-black uppercase tracking-widest text-gray-400 mb-2">Authenticated Visual & Code</p>
          <div class="grid grid-cols-1 md:grid-cols-5 gap-4 print-grid-fix">
            <div class="md:col-span-4 print-col-span-4 border border-gray-100 p-2 rounded bg-gray-50 h-32 flex items-center justify-center overflow-hidden">
               <img id="c-img" class="h-full object-contain" src="">
            </div>
            <div class="md:col-span-1 print-col-span-1 flex flex-col items-center justify-center">
               <div id="c-qr" class="bg-white p-2 border border-gray-200"></div>
               <p class="text-[8px] uppercase font-bold mt-1 text-center">Scan to Verify</p>
            </div>
          </div>
        </div>

        <div class="mt-auto pt-10 text-center relative z-10">
           <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Signature_sample.svg/1200px-Signature_sample.svg.png" class="h-10 mx-auto opacity-70 mb-2">
           <div class="w-48 border-t-2 border-ink mx-auto pt-1">
             <p class="font-black text-xs uppercase">Director General</p>
             <p class="text-[9px] text-gray-400">ARCON</p>
           </div>
        </div>

      </div>

      <div class="bg-gray-100 p-4 flex justify-center gap-4 no-print rounded-b-lg">
        <button onclick="window.print()" class="bg-ink text-white px-6 py-2 rounded font-bold hover:bg-black">Print / PDF</button>
      </div>
    </div>
  </div>

  <script>
    // --- STATE MANAGEMENT ---
    let currentUser = null;
    let myAssets = JSON.parse(localStorage.getItem('arcon_assets_v2') || "[]");
    let qrScanner = null;

    // --- HELPERS ---
    const getEl = (id) => document.getElementById(id);
    const openModal = (id) => getEl(id).classList.remove('hidden');
    const closeModal = (id) => getEl(id).classList.add('hidden');
    const money = (n) => new Intl.NumberFormat('en-NG', {style:'currency', currency:'NGN'}).format(n);

    // --- TOAST NOTIFICATIONS (SOCIAL PROOF) ---
    const msgs = [
      "Access Bank PLC just verified an asset.",
      "Dangote Group applied for a new license.",
      "Micro Press LTD renewed a billboard license.",
      "MTN Nigeria verified 3 assets in Lagos.",
      "Glo approved for 48-Sheet in Abuja."
    ];
    function showToast() {
      const txt = msgs[Math.floor(Math.random() * msgs.length)];
      const div = document.createElement('div');
      div.className = "bg-white/90 backdrop-blur border border-gray-200 shadow-lg p-3 rounded-lg text-xs flex items-center gap-2 toast-enter max-w-xs";
      div.innerHTML = `<i class="ph ph-check-circle text-arconGreen text-lg"></i> <span class="font-semibold text-gray-700">${txt}</span>`;
      getEl('toast-container').appendChild(div);
      setTimeout(() => {
        div.classList.remove('toast-enter');
        div.classList.add('toast-exit');
        setTimeout(() => div.remove(), 500);
      }, 4000);
    }
    setInterval(showToast, 6000); // Trigger every 6s

    // --- AUTH ---
    function openAuthModal(tab) {
      openModal('auth-modal');
      switchAuth(tab);
    }
    function switchAuth(tab) {
      if(tab === 'signin') {
        getEl('form-signin').classList.remove('hidden');
        getEl('form-signup').classList.add('hidden');
        getEl('tab-signin').className = "flex-1 py-4 bg-white text-arconGreen border-t-2 border-arconGreen";
        getEl('tab-signup').className = "flex-1 py-4 bg-gray-50 text-gray-500";
      } else {
        getEl('form-signin').classList.add('hidden');
        getEl('form-signup').classList.remove('hidden');
        getEl('tab-signup').className = "flex-1 py-4 bg-white text-arconGreen border-t-2 border-arconGreen";
        getEl('tab-signin').className = "flex-1 py-4 bg-gray-50 text-gray-500";
      }
    }
    function doLogin() {
      currentUser = {
        name: "Micro Press LTD",
        rc: "RC75875",
        email: getEl('login-email').value || "user@email.com",
        phone: "+2349032222984",
        type: "Agency"
      };
      
      // Update UI
      getEl('user-name-display').innerText = currentUser.name;
      getEl('auth-buttons').classList.add('hidden');
      getEl('user-menu').classList.remove('hidden');
      getEl('user-menu').classList.add('flex');
      
      closeModal('auth-modal');
      getEl('view-landing').classList.add('hidden');
      getEl('view-dashboard').classList.remove('hidden');
      getEl('view-dashboard').classList.add('flex');
      
      updateDash();
      dashSwitch('overview');
    }
    function doLogout() { location.reload(); }
    function goHome() { if(!currentUser) location.reload(); }

    // --- DASHBOARD ---
    function dashSwitch(tab) {
      ['overview','apply','assets'].forEach(t => {
         getEl('dash-'+t).classList.add('hidden');
         const nav = getEl('nav-'+t);
         if(t === tab) nav.className = "flex-1 md:flex-none text-left px-3 py-3 rounded-lg text-xs md:text-sm font-bold flex flex-col md:flex-row items-center gap-2 md:gap-3 bg-green-50 text-arconGreen";
         else nav.className = "flex-1 md:flex-none text-left px-3 py-3 rounded-lg text-xs md:text-sm font-bold flex flex-col md:flex-row items-center gap-2 md:gap-3 text-gray-600 hover:bg-gray-50";
      });
      getEl('dash-'+tab).classList.remove('hidden');
      
      if(tab === 'apply' && currentUser) {
        // AUTOFILL AGENCY
        getEl('agency-name').value = currentUser.name;
        getEl('agency-rc').value = currentUser.rc;
        getEl('agency-phone').value = currentUser.phone;
        // Reset file preview
        getEl('media-preview').innerHTML = '';
        currentFiles = [];
      }
      
      if(tab === 'assets') renderAssets();
    }

    function updateDash() {
      const active = myAssets.length;
      getEl('stat-active').innerText = active;
      getEl('stat-total').innerText = active;
      // demo stats
      getEl('stat-expiring').innerText = Math.floor(active * 0.2); 
    }

    // --- APPLICATION LOGIC ---
    let currentFiles = [];
    function previewMedia(input) {
      const container = getEl('media-preview');
      container.innerHTML = '';
      currentFiles = [];
      
      if(input.files) {
        Array.from(input.files).forEach(file => {
          const reader = new FileReader();
          reader.onload = (e) => {
             currentFiles.push(e.target.result);
             const img = document.createElement('img');
             img.src = e.target.result;
             img.className = "h-16 w-16 object-cover rounded border";
             container.appendChild(img);
          };
          reader.readAsDataURL(file);
        });
      }
    }

    function calcFee() {
       const state = getEl('state').value;
       const dur = getEl('dur-val').value;
       let base = 50000;
       if(state === 'Lagos') base = 100000;
       if(state === 'Abuja FCT') base = 85000;
       getEl('fee-display').innerText = money(base * dur);
    }

    function handleFormSubmit(e) {
      e.preventDefault();
      const id = "APP-" + new Date().getFullYear() + "-" + Math.floor(Math.random()*9000);
      const newAsset = {
        id: id,
        agency: {
          name: getEl('agency-name').value,
          rc: getEl('agency-rc').value
        },
        sponsor: getEl('sponsor').value,
        cat: getEl('industry').value,
        loc: getEl('state').value,
        date: new Date().toISOString().split('T')[0],
        img: currentFiles[0] || 'https://via.placeholder.com/300?text=No+Image'
      };
      
      myAssets.unshift(newAsset);
      localStorage.setItem('arcon_assets_v2', JSON.stringify(myAssets));
      
      alert(`License Generated Successfully!\nID: ${id}`);
      getEl('application-form').reset();
      updateDash();
      dashSwitch('assets');
    }

    // --- RENDER ASSETS ---
    function renderAssets() {
      const container = getEl('assets-container');
      container.innerHTML = '';
      
      if(myAssets.length === 0) {
        container.innerHTML = `<div class="text-center py-10 text-gray-400">No assets found. Create an application.</div>`;
        return;
      }

      myAssets.forEach(a => {
        const div = document.createElement('div');
        div.className = "bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex flex-col md:flex-row justify-between md:items-center gap-4";
        div.innerHTML = `
           <div class="flex items-start gap-4">
             <div class="h-16 w-16 bg-gray-100 rounded overflow-hidden flex-shrink-0">
               <img src="${a.img}" class="h-full w-full object-cover">
             </div>
             <div>
               <div class="font-black text-ink">${a.id}</div>
               <div class="text-sm text-gray-600">${a.sponsor}</div>
               <div class="text-xs text-green-600 font-bold bg-green-50 px-2 py-1 rounded-full inline-block mt-1">Active</div>
             </div>
           </div>
           <div class="flex gap-2">
             <button onclick="viewCert('${a.id}')" class="flex-1 md:flex-none px-4 py-2 bg-ink text-white rounded-lg text-xs font-bold">Certificate</button>
             <button onclick="downloadQR('${a.id}')" class="flex-1 md:flex-none px-4 py-2 border rounded-lg text-xs font-bold">QR Code</button>
           </div>
        `;
        container.appendChild(div);
      });
    }

    // --- CERTIFICATE VIEWER ---
    function viewCert(id) {
       const asset = myAssets.find(x => x.id === id);
       if(!asset) return;
       
       getEl('c-id').innerText = asset.id;
       getEl('c-sponsor').innerText = asset.sponsor;
       getEl('c-cat').innerText = asset.cat;
       getEl('c-loc').innerText = asset.loc;
       getEl('c-issue').innerText = asset.date;
       getEl('c-ag-name').innerText = asset.agency.name;
       getEl('c-ag-rc').innerText = asset.agency.rc;
       getEl('c-img').src = asset.img;

       const qrDiv = getEl('c-qr');
       qrDiv.innerHTML = '';
       new QRCode(qrDiv, { text: `ARCON-VERIFY:${asset.id}`, width: 80, height: 80 });

       openModal('certificate-modal');
    }

    // --- VERIFY MODAL ---
    function openVerifyModal() { openModal('verify-modal'); }
    function closeVerifyModal() { stopScanner(); closeModal('verify-modal'); }
    
    function performVerify() {
       const val = getEl('verify-input').value;
       const res = getEl('verify-result');
       res.classList.remove('hidden');
       
       if(myAssets.find(x => x.id === val)) {
         res.innerHTML = `<span class="text-green-600 font-black">VALID:</span> License ${val} is Active.`;
         res.className = "mt-4 p-3 rounded-lg bg-green-50 border border-green-200 text-sm block";
         setTimeout(() => { viewCert(val); closeVerifyModal(); }, 1000);
       } else {
         res.innerHTML = `<span class="text-red-600 font-black">INVALID:</span> License ID not found.`;
         res.className = "mt-4 p-3 rounded-lg bg-red-50 border border-red-200 text-sm block";
       }
    }

    // --- QR SCANNER ---
    async function startScanner() {
       if(qrScanner) await stopScanner();
       const reader = getEl('reader');
       reader.innerHTML = "";
       
       try {
         qrScanner = new Html5Qrcode("reader");
         await qrScanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 200 }, (decoded) => {
             const id = decoded.replace('ARCON-VERIFY:', '');
             getEl('verify-input').value = id;
             performVerify();
             stopScanner();
         });
       } catch(e) {
         alert("Camera failed. Use manual entry.");
       }
    }
    async function stopScanner() {
      if(qrScanner) { await qrScanner.stop().catch(()=>{}); qrScanner.clear(); qrScanner = null; }
      getEl('reader').innerHTML = '<div class="absolute inset-0 flex items-center justify-center text-gray-500 text-xs pointer-events-none">Camera Inactive</div>';
    }

    // --- INIT ---
    if(localStorage.getItem('arcon_assets_v2')) {
       // do nothing
    } else {
       // Seed dummy data
       myAssets = [
         { id: 'APP-2025-1001', agency: {name:'Micro Press', rc:'RC75875'}, sponsor: 'Zenith Bank', cat: 'Corporate Branding', loc: 'Lagos', date: '2025-12-01', img: 'https://images.unsplash.com/photo-1563986768609-322da13575f3?w=300' }
       ];
       localStorage.setItem('arcon_assets_v2', JSON.stringify(myAssets));
    }

  </script>
</body>
</html>
