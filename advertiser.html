<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>ARCON | Advertiser Services & Verification</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Icons -->
  <script src="https://unpkg.com/@phosphor-icons/web"></script>

  <!-- QR (Generate) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <!-- QR (Scan) -->
  <script src="https://unpkg.com/html5-qrcode@2.3.10/html5-qrcode.min.js"></script>

  <style>
    :root{
      --ink:#0b1220;
      --arconGreen:#0ea86b;
      --arconGreen2:#0b8d5a;
      --arconYellow:#f7c948;
      --arconYellow2:#e9b938;
      --paper:#ffffff;
      --bg:#f7fafc;
    }
    *{ font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji"; }
    html,body{ height:100%; }
    body{ background: var(--bg); color: var(--ink); }

    .hero-bg{
      background:
        radial-gradient(900px 400px at 10% 20%, rgba(14,168,107,.18), transparent 55%),
        radial-gradient(900px 500px at 90% 10%, rgba(247,201,72,.22), transparent 55%),
        linear-gradient(180deg, #ffffff, #f7fafc);
    }

    .glow-dot{
      box-shadow: 0 0 0 0 rgba(14,168,107,.45);
      animation: pulse 1.8s infinite;
    }
    @keyframes pulse{
      0%{ box-shadow: 0 0 0 0 rgba(14,168,107,.35); }
      70%{ box-shadow: 0 0 0 10px rgba(14,168,107,0); }
      100%{ box-shadow: 0 0 0 0 rgba(14,168,107,0); }
    }

    .ring-grad{
      position:relative;
    }
    .ring-grad::before{
      content:"";
      position:absolute;
      inset:-1px;
      border-radius: 18px;
      background: linear-gradient(90deg, rgba(14,168,107,.85), rgba(247,201,72,.85), rgba(14,168,107,.85));
      filter: blur(0px);
      z-index:-1;
      animation: shimmer 4s linear infinite;
      background-size: 240% 100%;
    }
    @keyframes shimmer{
      0%{ background-position: 0% 50%; }
      100%{ background-position: 100% 50%; }
    }

    .tap{
      transform: translateY(0);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .tap:active{ transform: translateY(1px); }

    /* Print */
    @media print {
      @page { size: A4; margin: 10mm; }
      *{ -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
      .no-print{ display:none !important; }
      body{ background: white !important; }
      #certificate-modal{
        position: static !important;
        inset: auto !important;
        background: transparent !important;
        padding: 0 !important;
      }
      #certificate-container{
        width: 100% !important;
        max-width: none !important;
        margin: 0 !important;
        box-shadow: none !important;
      }
      #certificate-container .p-10{ padding: 24px !important; }
      .print-avoid-break{
        break-inside: avoid;
        page-break-inside: avoid;
      }
    }
  </style>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            ink: "var(--ink)",
            arconGreen: "var(--arconGreen)",
            arconGreen2: "var(--arconGreen2)",
            arconYellow: "var(--arconYellow)",
            arconYellow2: "var(--arconYellow2)",
          }
        }
      }
    }
  </script>
</head>

<body class="min-h-screen">
  <!-- Top Bar -->
  <header class="no-print sticky top-0 z-40 backdrop-blur bg-white/85 border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between gap-3">
      <div class="flex items-center gap-3">
        <!-- Inline ARCON Mark (no external placeholder assets) -->
        <div class="w-10 h-10 rounded-2xl bg-ink flex items-center justify-center">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-label="ARCON">
            <path d="M12 2.8L20.8 7.9V16.1L12 21.2L3.2 16.1V7.9L12 2.8Z" stroke="white" stroke-width="1.8"/>
            <path d="M12 6.4L17.7 9.7V14.3L12 17.6L6.3 14.3V9.7L12 6.4Z" fill="white" opacity=".18"/>
            <path d="M8.2 12h7.6" stroke="white" stroke-width="1.8" stroke-linecap="round"/>
            <path d="M12 8.2v7.6" stroke="white" stroke-width="1.8" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="leading-tight">
          <div class="flex items-center gap-2">
            <span class="font-black tracking-tight text-ink">ARCON</span>
            <span class="text-[10px] font-black uppercase tracking-widest text-gray-500">Integrated Advertiser Platform</span>
          </div>
          <div class="flex items-center gap-2 text-xs text-gray-600">
            <span class="inline-flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-arconGreen glow-dot"></span>
              Live Verification
            </span>
            <span class="text-gray-300">•</span>
            <span class="hidden sm:inline">Licensing • Vetting • Certificate Validation</span>
          </div>
        </div>
      </div>

      <div class="flex items-center gap-2">
        <button onclick="openVerifyModal()" class="tap flex items-center gap-2 text-sm font-extrabold text-gray-600 hover:text-arconGreen transition">
          <i class="ph ph-scan text-lg"></i>
          <span class="hidden sm:inline">Verify Asset</span>
        </button>
        <button id="btn-login" onclick="openAuthModal()" class="tap px-4 py-2 rounded-xl font-black bg-ink text-white hover:bg-black">
          Login / Register
        </button>
        <button id="btn-logout" onclick="logout()" class="hidden tap px-4 py-2 rounded-xl font-black bg-arconYellow text-ink hover:bg-arconYellow2">
          Logout
        </button>
      </div>
    </div>
  </header>

  <!-- HOME -->
  <main id="home" class="block">
    <!-- HERO -->
    <section class="hero-bg">
      <div class="max-w-7xl mx-auto px-4 py-10 md:py-14">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-center">
          <div class="lg:col-span-7">
            <div class="inline-flex items-center gap-2 px-3 py-2 rounded-full bg-white border border-gray-200 shadow-sm">
              <i class="ph ph-shield-check text-arconGreen text-lg"></i>
              <span class="text-xs font-extrabold uppercase tracking-widest text-gray-600">Compliance-first verification</span>
            </div>

            <h1 class="mt-4 text-4xl md:text-5xl font-black tracking-tight text-ink leading-[1.05]">
              License applications, ad vetting & certificate verification—<span class="text-arconGreen">all in one place</span>.
            </h1>

            <p class="mt-4 text-gray-600 text-lg max-w-2xl">
              Submit a license application, generate a scannable certificate, and verify assets instantly.
              Missing compliance can cost campaigns real money—build proof now, not after enforcement.
            </p>

            <div class="mt-6 flex flex-col sm:flex-row gap-3">
              <button onclick="gateToDashboard('apply')" class="tap w-full sm:w-auto px-6 py-3 rounded-2xl bg-ink text-white font-black hover:bg-black flex items-center justify-center gap-2">
                <i class="ph ph-file-text"></i> Start New License Application
              </button>
              <button onclick="openVerifyModal()" class="tap w-full sm:w-auto px-6 py-3 rounded-2xl bg-white border border-gray-200 font-black text-ink hover:border-arconGreen flex items-center justify-center gap-2">
                <i class="ph ph-scan"></i> Verify Certificate / Asset
              </button>
            </div>

            <div class="mt-6 flex flex-wrap gap-2 text-xs">
              <span class="px-3 py-2 rounded-full bg-white border border-gray-200 font-extrabold text-gray-600">
                <i class="ph ph-lock-key-open mr-1"></i> Tamper-resistant QR
              </span>
              <span class="px-3 py-2 rounded-full bg-white border border-gray-200 font-extrabold text-gray-600">
                <i class="ph ph-timer mr-1"></i> Faster reviews
              </span>
              <span class="px-3 py-2 rounded-full bg-white border border-gray-200 font-extrabold text-gray-600">
                <i class="ph ph-map-pin mr-1"></i> Traceable assets
              </span>
              <span class="px-3 py-2 rounded-full bg-white border border-gray-200 font-extrabold text-gray-600">
                <i class="ph ph-seal-check mr-1"></i> Certificate validation
              </span>
            </div>
          </div>

          <div class="lg:col-span-5">
            <div class="ring-grad rounded-[18px] bg-white p-5 shadow-xl border border-gray-100">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Quick Actions</p>
                  <p class="text-xl font-black text-ink mt-1">One dashboard. Zero excuses.</p>
                </div>
                <div class="w-10 h-10 rounded-2xl bg-arconGreen/10 flex items-center justify-center text-arconGreen text-xl">
                  <i class="ph ph-command"></i>
                </div>
              </div>

              <div class="mt-4 grid grid-cols-1 gap-3">
                <button onclick="gateToDashboard('apply')" class="tap w-full text-left px-4 py-4 rounded-2xl border border-gray-200 hover:border-arconGreen bg-white">
                  <div class="flex items-start gap-3">
                    <div class="w-10 h-10 rounded-2xl bg-arconYellow/25 flex items-center justify-center text-ink text-xl">
                      <i class="ph ph-file-plus"></i>
                    </div>
                    <div>
                      <p class="font-black text-ink">New License Application</p>
                      <p class="text-sm text-gray-600 mt-1">Submit, pay, download invoice, track status.</p>
                    </div>
                  </div>
                </button>

                <button onclick="openVerifyModal()" class="tap w-full text-left px-4 py-4 rounded-2xl border border-gray-200 hover:border-arconGreen bg-white">
                  <div class="flex items-start gap-3">
                    <div class="w-10 h-10 rounded-2xl bg-arconGreen/10 flex items-center justify-center text-arconGreen text-xl">
                      <i class="ph ph-qr-code"></i>
                    </div>
                    <div>
                      <p class="font-black text-ink">Verification Portal</p>
                      <p class="text-sm text-gray-600 mt-1">Scan QR or input certificate number.</p>
                    </div>
                  </div>
                </button>

                <button onclick="gateToDashboard('status')" class="tap w-full text-left px-4 py-4 rounded-2xl border border-gray-200 hover:border-arconGreen bg-white">
                  <div class="flex items-start gap-3">
                    <div class="w-10 h-10 rounded-2xl bg-blue-50 flex items-center justify-center text-blue-700 text-xl">
                      <i class="ph ph-hourglass"></i>
                    </div>
                    <div>
                      <p class="font-black text-ink">Application Status</p>
                      <p class="text-sm text-gray-600 mt-1">See progress, download certificates.</p>
                    </div>
                  </div>
                </button>
              </div>

              <div class="mt-4 text-xs text-gray-500">
                By submitting, you agree to platform rules and compliance requirements for advertising operations.
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- STATS -->
    <section class="bg-white py-12 px-4">
      <div class="max-w-7xl mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="border border-gray-200 rounded-2xl p-6 shadow-sm">
            <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Total Vettings</p>
            <div class="text-4xl font-black text-ink mt-2"><span data-counter="12842">0</span>+</div>
            <p class="text-sm text-gray-600 mt-2">Ads processed through verification flows.</p>
          </div>
          <div class="border border-gray-200 rounded-2xl p-6 shadow-sm">
            <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Avg Turnaround</p>
            <div class="text-4xl font-black text-ink mt-2"><span data-counter="36">0</span> hrs</div>
            <p class="text-sm text-gray-600 mt-2">Typical review-to-approval window.</p>
          </div>
          <div class="border border-gray-200 rounded-2xl p-6 shadow-sm">
            <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Coverage</p>
            <div class="text-4xl font-black text-ink mt-2"><span data-counter="36">0</span> states</div>
            <p class="text-sm text-gray-600 mt-2">Jurisdiction mapping & compliance checks.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- FOMO -->
    <section class="bg-gray-50 py-12 px-4">
      <div class="max-w-7xl mx-auto">
        <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
          <div>
            <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Compliance Reality</p>
            <h2 class="text-3xl md:text-4xl font-black text-ink mt-2">Unvetted ads are a risk multiplier.</h2>
            <p class="text-gray-600 mt-3 max-w-2xl">
              Unvetted placements can lead to takedowns, lost media spend, reputational damage, and enforcement action.
              Certification is your proof—before anyone asks for it.
            </p>
          </div>
          <button onclick="openVerifyModal()" class="tap bg-ink text-white px-6 py-3 rounded-xl font-black hover:bg-black w-full md:w-auto">
            Verify an Asset Now
          </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
          <div class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm">
            <div class="text-arconYellow2 text-2xl"><i class="ph ph-warning-circle"></i></div>
            <h3 class="font-black text-ink mt-3">Takedown risk</h3>
            <p class="text-sm text-gray-600 mt-2">Your billboard or placement can be flagged and pulled mid-campaign.</p>
          </div>
          <div class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm">
            <div class="text-arconGreen text-2xl"><i class="ph ph-shield-check"></i></div>
            <h3 class="font-black text-ink mt-3">Proof when challenged</h3>
            <p class="text-sm text-gray-600 mt-2">A scannable certificate reduces friction with site owners and regulators.</p>
          </div>
          <div class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm">
            <div class="text-blue-700 text-2xl"><i class="ph ph-lightning"></i></div>
            <h3 class="font-black text-ink mt-3">Faster approvals</h3>
            <p class="text-sm text-gray-600 mt-2">Clean submissions get reviewed faster—avoid delays from missing details.</p>
          </div>
        </div>
      </div>
    </section>

    <footer class="py-10 px-4 text-center text-sm text-gray-500">
      © <span id="year"></span> ARCON Integrated Platform. All rights reserved.
    </footer>
  </main>

  <!-- DASHBOARD -->
  <section id="dashboard" class="hidden">
    <div class="max-w-7xl mx-auto px-4 py-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
        <div>
          <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Advertiser Dashboard</p>
          <h2 class="text-2xl md:text-3xl font-black text-ink mt-1">Welcome, <span id="dash-name">—</span></h2>
          <p class="text-gray-600 mt-2">Submit applications, download invoices, track status, and generate certificates.</p>
        </div>

        <div class="flex gap-2">
          <button onclick="switchTab('apply')" class="tap px-4 py-2 rounded-xl font-black bg-ink text-white hover:bg-black">
            New Application
          </button>
          <button onclick="switchTab('status')" class="tap px-4 py-2 rounded-xl font-black bg-white border border-gray-200 hover:border-arconGreen">
            Application Status
          </button>
          <button onclick="openVerifyModal()" class="tap px-4 py-2 rounded-xl font-black bg-arconYellow text-ink hover:bg-arconYellow2">
            Verify
          </button>
        </div>
      </div>

      <!-- Tabs -->
      <div class="mt-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
        <!-- Left -->
        <div class="lg:col-span-4">
          <div class="bg-white border border-gray-200 rounded-2xl p-5 shadow-sm">
            <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Account</p>
            <div class="mt-3 space-y-2 text-sm">
              <div class="flex items-center justify-between gap-3">
                <span class="text-gray-500 font-bold">Company</span>
                <span id="acct-company" class="font-black text-ink text-right">—</span>
              </div>
              <div class="flex items-center justify-between gap-3">
                <span class="text-gray-500 font-bold">RC Number</span>
                <span id="acct-rc" class="font-black text-ink text-right">—</span>
              </div>
              <div class="flex items-center justify-between gap-3">
                <span class="text-gray-500 font-bold">Email</span>
                <span id="acct-email" class="font-black text-ink text-right">—</span>
              </div>
              <div class="flex items-center justify-between gap-3">
                <span class="text-gray-500 font-bold">Phone</span>
                <span id="acct-phone" class="font-black text-ink text-right">—</span>
              </div>
            </div>

            <div class="mt-5 border-t pt-4">
              <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">ARCON Payment Details</p>
              <div class="mt-2 text-sm text-gray-700">
                <div class="font-black text-ink">ARCON ADs VETTING</div>
                <div class="mt-1">Stanbic IBTC Bank</div>
                <div class="mt-1 font-black text-ink">5770242424</div>
                <div class="mt-2 text-xs text-gray-500">
                  After payment, upload evidence in your application and download your invoice/receipt from Status.
                </div>
              </div>
            </div>
          </div>

          <div class="mt-6 bg-white border border-gray-200 rounded-2xl p-5 shadow-sm">
            <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Compliance Tip</p>
            <p class="mt-2 text-sm text-gray-600">
              Make sure your ad assets match the declared media type, location, and duration. Mismatches cause delays.
            </p>
          </div>
        </div>

        <!-- Right -->
        <div class="lg:col-span-8">
          <!-- APPLY TAB -->
          <div id="tab-apply" class="bg-white border border-gray-200 rounded-2xl p-5 shadow-sm">
            <div class="flex items-center justify-between gap-3">
              <div>
                <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">New License Application</p>
                <h3 class="text-xl font-black text-ink mt-1">Submit your details (RC required)</h3>
              </div>
              <div class="w-10 h-10 rounded-2xl bg-arconGreen/10 flex items-center justify-center text-arconGreen text-xl">
                <i class="ph ph-file-plus"></i>
              </div>
            </div>

            <form id="application-form" class="mt-5 space-y-6" onsubmit="handleFormSubmit(event)">
              <!-- Agency / Company (Auto-synced to logged-in user) -->
              <div class="border border-gray-200 rounded-2xl p-4">
                <div class="flex items-center justify-between">
                  <p class="font-black text-ink">Advertising Company (Agency)</p>
                  <span class="text-[10px] font-black uppercase tracking-widest text-gray-500">Auto-linked to your login</span>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                  <div>
                    <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1">Company Name</label>
                    <input id="agency-name" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" required>
                  </div>
                  <div>
                    <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1">Contact Person</label>
                    <input id="agency-contact" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" required>
                  </div>
                  <div>
                    <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1">Email</label>
                    <input id="agency-email" type="email" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" required>
                  </div>
                  <div>
                    <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1">Phone</label>
                    <input id="agency-phone" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" required>
                  </div>
                  <div class="md:col-span-2">
                    <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1">RC Number <span class="text-red-500">*</span></label>
                    <input id="agency-rc" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" required>
                    <p class="text-[11px] text-gray-500 mt-1">RC Number is mandatory and locked to the logged-in advertiser record.</p>
                  </div>
                </div>
              </div>

              <!-- Application details -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1">License Type</label>
                  <select id="license-type" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" required>
                    <option value="" disabled selected>Select</option>
                    <option>Advertising Agency License</option>
                    <option>Outdoor Media Operator License</option>
                    <option>Media Buying License</option>
                    <option>Special Campaign Permit</option>
                  </select>
                </div>
                <div>
                  <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1">Jurisdiction</label>
                  <select id="jurisdiction" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" required>
                    <option value="" disabled selected>Select</option>
                    <option>Federal</option>
                    <option>State</option>
                    <option>FCT</option>
                  </select>
                </div>
                <div>
                  <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1">State (if applicable)</label>
                  <input id="state" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" placeholder="e.g. Lagos" required>
                </div>
                <div>
                  <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1">Business Address</label>
                  <input id="address" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" placeholder="Full address" required>
                </div>
              </div>

              <!-- Ad / Asset details -->
              <div class="border border-gray-200 rounded-2xl p-4">
                <p class="font-black text-ink">Asset / Campaign Details</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                  <div>
                    <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1">Media Type</label>
                    <select id="media-type" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" required>
                      <option value="" disabled selected>Select</option>
                      <option>Billboard</option>
                      <option>LED Screen</option>
                      <option>Transit (Bus / Taxi)</option>
                      <option>Print (Flyer / Poster)</option>
                      <option>Digital (Social / Web)</option>
                    </select>
                  </div>

                  <div>
                    <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1">Campaign Duration (days)</label>
                    <input id="duration" type="number" min="1" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" value="30" required>
                  </div>

                  <div class="md:col-span-2">
                    <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1">Asset Location / Deployment Notes</label>
                    <textarea id="asset-notes" rows="3" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" placeholder="Landmark, route, GPS note, venue, etc." required></textarea>
                  </div>

                  <div class="md:col-span-2">
                    <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1">Upload Creative (Images)</label>
                    <input id="creative-files" type="file" accept="image/*" multiple class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen bg-white" required>
                    <p class="text-[11px] text-gray-500 mt-1">We store files locally in your browser for this demo build. Production uses secure storage.</p>
                  </div>

                  <div class="md:col-span-2">
                    <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1">Payment Evidence (optional upload)</label>
                    <input id="payment-proof" type="file" accept="image/*,application/pdf" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen bg-white">
                    <p class="text-[11px] text-gray-500 mt-1">Pay to: ARCON ADs VETTING • Stanbic IBTC • 5770242424</p>
                  </div>
                </div>
              </div>

              <!-- Fee + Submit -->
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 border-t pt-5">
                <div>
                  <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Estimated Fee</p>
                  <p class="text-2xl font-black text-ink mt-1">₦ <span id="fee-amt">250,000</span></p>
                  <p class="text-xs text-gray-500 mt-1">Final fee may vary based on media type, duration, and jurisdiction.</p>
                </div>
                <div class="flex gap-2">
                  <button type="button" onclick="downloadDraftInvoice()" class="tap px-5 py-3 rounded-2xl border border-gray-200 bg-white font-black hover:border-arconGreen">
                    Download Invoice
                  </button>
                  <button type="submit" class="tap px-6 py-3 rounded-2xl bg-arconGreen text-white font-black hover:bg-arconGreen2 flex items-center gap-2 justify-center">
                    <i class="ph ph-paper-plane-tilt"></i> Submit Application
                  </button>
                </div>
              </div>
            </form>
          </div>

          <!-- STATUS TAB -->
          <div id="tab-status" class="hidden bg-white border border-gray-200 rounded-2xl p-5 shadow-sm">
            <div class="flex items-center justify-between gap-3">
              <div>
                <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Application Status</p>
                <h3 class="text-xl font-black text-ink mt-1">Track, download, and generate certificates</h3>
              </div>
              <div class="w-10 h-10 rounded-2xl bg-blue-50 flex items-center justify-center text-blue-700 text-xl">
                <i class="ph ph-hourglass"></i>
              </div>
            </div>

            <div class="mt-5 overflow-x-auto">
              <table class="min-w-full text-sm">
                <thead>
                  <tr class="text-left text-xs uppercase tracking-widest text-gray-500 border-b">
                    <th class="py-3 pr-4 font-black">Ref</th>
                    <th class="py-3 pr-4 font-black">License</th>
                    <th class="py-3 pr-4 font-black">Status</th>
                    <th class="py-3 pr-4 font-black">Submitted</th>
                    <th class="py-3 pr-4 font-black">Actions</th>
                  </tr>
                </thead>
                <tbody id="apps-tbody"></tbody>
              </table>
              <p id="no-apps" class="hidden mt-4 text-gray-600">No applications yet. Submit one to start.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- AUTH MODAL -->
  <div id="auth-modal" class="no-print fixed inset-0 z-50 hidden items-end sm:items-center justify-center bg-black/60 backdrop-blur-sm p-0 sm:p-4">
    <div class="bg-white w-full sm:max-w-lg rounded-t-3xl sm:rounded-2xl shadow-2xl overflow-hidden max-h-[92vh] overflow-y-auto">
      <div class="p-5 border-b flex items-center justify-between gap-3">
        <div>
          <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Access</p>
          <p class="text-xl font-black text-ink mt-1">Login or Register</p>
        </div>
        <button onclick="closeAuthModal()" class="tap w-10 h-10 rounded-2xl border border-gray-200 hover:border-arconGreen flex items-center justify-center">
          <i class="ph ph-x"></i>
        </button>
      </div>

      <div class="p-5">
        <div class="grid grid-cols-2 gap-2">
          <button id="auth-tab-login" onclick="authTab('login')" class="tap px-4 py-3 rounded-2xl font-black bg-ink text-white">Login</button>
          <button id="auth-tab-register" onclick="authTab('register')" class="tap px-4 py-3 rounded-2xl font-black bg-white border border-gray-200 hover:border-arconGreen">Register</button>
        </div>

        <!-- LOGIN -->
        <div id="auth-login" class="mt-5">
          <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1">Email</label>
          <input id="login-email" type="email" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" placeholder="company@email.com">
          <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1 mt-3">Password</label>
          <input id="login-pass" type="password" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" placeholder="••••••••">

          <button onclick="doLogin()" class="tap mt-4 w-full px-5 py-3 rounded-2xl bg-arconGreen text-white font-black hover:bg-arconGreen2 flex items-center justify-center gap-2">
            <i class="ph ph-sign-in"></i> Login
          </button>

          <p class="text-xs text-gray-500 mt-3">
            Your account is tied to RC Number. If you registered, use the same email and password.
          </p>
        </div>

        <!-- REGISTER -->
        <div id="auth-register" class="mt-5 hidden">
          <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1">Company Name</label>
          <input id="reg-name" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" placeholder="Your registered company name">

          <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1 mt-3">RC Number <span class="text-red-500">*</span></label>
          <input id="reg-rc" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" placeholder="RC123456">

          <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1 mt-3">Email</label>
          <input id="reg-email" type="email" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" placeholder="company@email.com">

          <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1 mt-3">Phone</label>
          <input id="reg-phone" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" placeholder="+234...">

          <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1 mt-3">Password</label>
          <input id="reg-pass" type="password" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" placeholder="Create a strong password">

          <button onclick="doRegister()" class="tap mt-4 w-full px-5 py-3 rounded-2xl bg-ink text-white font-black hover:bg-black flex items-center justify-center gap-2">
            <i class="ph ph-user-plus"></i> Create Account
          </button>

          <p class="text-xs text-gray-500 mt-3">
            RC Number is mandatory. This becomes your advertiser identity in submissions and certificates.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- VERIFY MODAL (compact bottom-sheet on mobile) -->
  <div id="verify-modal" class="no-print fixed inset-0 z-50 hidden flex items-end sm:items-center justify-center bg-black/60 backdrop-blur-sm p-0 sm:p-4 overflow-y-auto">
    <div class="bg-white w-full sm:max-w-4xl rounded-t-3xl sm:rounded-2xl shadow-2xl overflow-hidden relative max-h-[92vh] overflow-y-auto">
      <div class="p-5 border-b flex items-center justify-between gap-3">
        <div>
          <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Verification Portal</p>
          <p class="text-xl font-black text-ink mt-1">Scan QR or input certificate number</p>
        </div>
        <button onclick="closeVerifyModal()" class="tap w-10 h-10 rounded-2xl border border-gray-200 hover:border-arconGreen flex items-center justify-center">
          <i class="ph ph-x"></i>
        </button>
      </div>

      <div class="p-5 grid grid-cols-1 lg:grid-cols-12 gap-6">
        <div class="lg:col-span-6">
          <div class="border border-gray-200 rounded-2xl p-4">
            <div class="flex items-center justify-between">
              <p class="font-black text-ink">QR Scanner</p>
              <button onclick="toggleScanner()" class="tap px-3 py-2 rounded-xl font-black text-xs bg-arconGreen/10 text-arconGreen hover:bg-arconGreen/15">
                <i class="ph ph-camera mr-1"></i> <span id="scanner-toggle-label">Start</span>
              </button>
            </div>
            <div id="reader" class="mt-3 w-full rounded-xl overflow-hidden border bg-gray-50 min-h-[190px] sm:min-h-[240px] md:min-h-[260px] flex items-center justify-center">
              <div class="text-sm text-gray-500 text-center px-6">
                Tap <span class="font-black text-ink">Start</span> and point the camera at the QR.
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-3">
              Tip: ensure good lighting and keep the QR centered.
            </p>
          </div>
        </div>

        <div class="lg:col-span-6">
          <div class="border border-gray-200 rounded-2xl p-4">
            <p class="font-black text-ink">Manual Verification</p>
            <label class="block text-xs font-extrabold text-gray-500 uppercase mb-1 mt-3">Certificate Number</label>
            <div class="flex gap-2">
              <input id="verify-cert-no" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-arconGreen" placeholder="e.g. ARCON-2025-000123">
              <button onclick="verifyCertificate()" class="tap px-5 py-3 rounded-xl bg-ink text-white font-black hover:bg-black">
                Verify
              </button>
            </div>

            <div id="verify-result" class="hidden mt-4 border border-gray-200 rounded-2xl p-4 bg-white">
              <div class="flex items-start justify-between gap-3">
                <div class="flex items-start gap-3">
                  <div id="verify-badge" class="w-11 h-11 rounded-2xl flex items-center justify-center text-xl"></div>
                  <div>
                    <p id="verify-title" class="font-black text-ink">—</p>
                    <p id="verify-sub" class="text-sm text-gray-600 mt-1">—</p>
                  </div>
                </div>
                <button onclick="openCertificateFromVerify()" class="tap px-4 py-2 rounded-xl font-black border border-gray-200 hover:border-arconGreen bg-white">
                  View Certificate
                </button>
              </div>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-4 text-sm">
                <div class="border border-gray-200 rounded-xl p-3">
                  <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Company</p>
                  <p id="v-company" class="font-black text-ink mt-1">—</p>
                </div>
                <div class="border border-gray-200 rounded-xl p-3">
                  <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">RC</p>
                  <p id="v-rc" class="font-black text-ink mt-1">—</p>
                </div>
                <div class="border border-gray-200 rounded-xl p-3">
                  <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Media Type</p>
                  <p id="v-media" class="font-black text-ink mt-1">—</p>
                </div>
                <div class="border border-gray-200 rounded-xl p-3">
                  <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Issued</p>
                  <p id="v-issued" class="font-black text-ink mt-1">—</p>
                </div>
              </div>
            </div>

            <p class="text-xs text-gray-500 mt-3">
              Verification checks certificate integrity and cross-matches submission details.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CERTIFICATE MODAL (print-ready) -->
  <div id="certificate-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/70 backdrop-blur-sm p-4 overflow-y-auto">
    <div id="certificate-container" class="bg-white w-full max-w-4xl rounded-3xl shadow-2xl overflow-hidden relative">
      <div class="no-print p-4 border-b flex items-center justify-between gap-3">
        <div>
          <p class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Certificate Preview</p>
          <p class="text-lg font-black text-ink mt-1">Printable certificate (A4 optimized)</p>
        </div>
        <div class="flex gap-2">
          <button onclick="window.print()" class="tap px-4 py-2 rounded-xl font-black bg-ink text-white hover:bg-black">
            Print / Save PDF
          </button>
          <button onclick="closeCertificateModal()" class="tap w-10 h-10 rounded-2xl border border-gray-200 hover:border-arconGreen flex items-center justify-center">
            <i class="ph ph-x"></i>
          </button>
        </div>
      </div>

      <!-- CERT CONTENT -->
      <div class="p-10">
        <div class="flex items-start justify-between gap-4 print-avoid-break">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 rounded-2xl bg-ink flex items-center justify-center">
              <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-label="ARCON">
                <path d="M12 2.8L20.8 7.9V16.1L12 21.2L3.2 16.1V7.9L12 2.8Z" stroke="white" stroke-width="1.8"/>
                <path d="M12 6.4L17.7 9.7V14.3L12 17.6L6.3 14.3V9.7L12 6.4Z" fill="white" opacity=".18"/>
                <path d="M8.2 12h7.6" stroke="white" stroke-width="1.8" stroke-linecap="round"/>
                <path d="M12 8.2v7.6" stroke="white" stroke-width="1.8" stroke-linecap="round"/>
              </svg>
            </div>
            <div>
              <div class="text-sm font-black text-ink">Advertising Regulatory Council of Nigeria</div>
              <div class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Verification Certificate</div>
            </div>
          </div>

          <div class="text-right">
            <div class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Certificate Number</div>
            <div id="cert-number" class="text-lg font-black text-ink mt-1">—</div>
            <div class="text-xs text-gray-500 mt-1">Issued: <span id="cert-issued">—</span></div>
          </div>
        </div>

        <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4 print-avoid-break">
          <div class="border border-gray-200 rounded-2xl p-4">
            <div class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Company</div>
            <div id="cert-company" class="text-xl font-black text-ink mt-1">—</div>
            <div class="mt-2 text-sm text-gray-700">
              <span class="text-gray-500 font-bold">RC:</span> <span id="cert-rc" class="font-black text-ink">—</span>
            </div>
            <div class="mt-2 text-sm text-gray-700">
              <span class="text-gray-500 font-bold">License:</span> <span id="cert-license" class="font-black text-ink">—</span>
            </div>
          </div>

          <div class="border border-gray-200 rounded-2xl p-4">
            <div class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Asset Details</div>
            <div class="mt-2 text-sm text-gray-700">
              <span class="text-gray-500 font-bold">Media Type:</span> <span id="cert-media-type" class="font-black text-ink">—</span>
            </div>
            <div class="mt-2 text-sm text-gray-700">
              <span class="text-gray-500 font-bold">Duration:</span> <span id="cert-duration" class="font-black text-ink">—</span> days
            </div>
            <div class="mt-2 text-sm text-gray-700">
              <span class="text-gray-500 font-bold">Jurisdiction:</span> <span id="cert-juris" class="font-black text-ink">—</span>
            </div>
            <div class="mt-2 text-sm text-gray-700">
              <span class="text-gray-500 font-bold">Location Notes:</span>
              <div id="cert-notes" class="font-semibold text-ink mt-1 leading-relaxed">—</div>
            </div>
          </div>
        </div>

        <!-- MEDIA + QR (aligned) -->
        <div class="mt-6 border border-gray-200 rounded-2xl p-4 print-avoid-break">
          <div class="flex items-center justify-between gap-3">
            <div>
              <div class="text-xs font-extrabold uppercase tracking-widest text-gray-500">Submitted Creative</div>
              <div class="text-sm text-gray-600 mt-1">This certificate is valid only for the submitted creative and declared deployment.</div>
            </div>
            <div class="text-xs font-black text-gray-500 uppercase tracking-widest">Scan QR to verify</div>
          </div>

          <div class="mt-4 grid grid-cols-1 md:grid-cols-[1fr_220px] gap-4 items-start">
            <div class="print-avoid-break">
              <div id="cert-media" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3"></div>
            </div>

            <div class="print-avoid-break">
              <div class="border border-gray-200 rounded-2xl p-3 bg-white">
                <div class="text-center">
                  <div class="text-[10px] font-black uppercase tracking-widest text-gray-500">Verification QR</div>

                  <div class="mt-2 flex items-center justify-center">
                    <div id="cert-qrcode" class="bg-white p-2 border border-gray-200 shadow-sm inline-block rounded-xl"></div>
                  </div>

                  <button onclick="downloadCertificateQR()" class="mt-3 w-full text-xs font-black px-3 py-2 rounded-lg bg-arconYellow text-ink hover:bg-arconYellow2 no-print">
                    Download QR
                  </button>

                  <p class="text-[9px] uppercase font-black mt-2 text-gray-400">Scan to Authenticate</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Declaration -->
        <div class="mt-6 border border-gray-200 rounded-2xl p-4 print-avoid-break">
          <div class="flex items-start gap-3">
            <div class="w-10 h-10 rounded-2xl bg-arconGreen/10 flex items-center justify-center text-arconGreen text-xl">
              <i class="ph ph-seal-check"></i>
            </div>
            <div>
              <p class="font-black text-ink">Declaration</p>
              <p class="text-sm text-gray-700 mt-1 leading-relaxed">
                This certificate confirms the advertiser submission record and makes the asset verifiable via QR or certificate number.
                Any modification of creative, deployment location, or duration requires a fresh submission and review.
              </p>
            </div>
          </div>
        </div>

        <!-- DG Signature (centered) -->
        <div class="mt-10 relative z-10 flex justify-center print-avoid-break">
          <div class="text-center">
            <!-- Real embedded signature SVG (not a sample URL) -->
            <svg class="h-10 mx-auto mb-2 opacity-90" viewBox="0 0 520 140" fill="none" aria-label="DG Signature">
              <path d="M32 96c24-34 47-52 70-52 35 0 34 60 69 60 23 0 45-26 64-46 19-20 33-34 52-34 26 0 24 34 44 34 24 0 44-44 64-44 25 0 22 44 49 44 20 0 30-16 40-30 12-16 23-30 41-30 25 0 22 54 49 54 21 0 33-23 47-48"
                    stroke="#0b1220" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M90 94c-6 20-9 30-9 30" stroke="#0b1220" stroke-width="6" stroke-linecap="round"/>
              <path d="M170 106c-8 18-12 28-12 28" stroke="#0b1220" stroke-width="6" stroke-linecap="round"/>
            </svg>

            <div class="w-72 border-b-2 border-ink mb-2 mx-auto"></div>
            <p class="font-black text-xs uppercase">Director General</p>
            <p class="text-[10px] text-gray-400">ARCON</p>
          </div>
        </div>

        <div class="mt-6 text-[11px] text-gray-500 leading-relaxed">
          Verification instructions: scan the QR code or enter the certificate number in the ARCON verification portal.
          Certificates are validated against advertiser record, submission metadata, and stored creative hash.
        </div>
      </div>
    </div>
  </div>

  <!-- Social Proof Toast Container -->
  <div id="social-proof" class="no-print fixed z-[90] bottom-4 left-4 right-4 sm:left-auto sm:right-6 sm:bottom-6 space-y-2 pointer-events-none"></div>

  <script>
    // ===== Helpers
    const getEl = (id) => document.getElementById(id);
    const escapeHtml = (s) => String(s ?? "").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    const nowISO = () => new Date().toISOString();
    const fmtDate = (iso) => {
      try {
        const d = new Date(iso);
        return d.toLocaleString(undefined, { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' });
      } catch { return iso; }
    };
    const pad = (n, w=6) => String(n).padStart(w,'0');

    // ===== Data Layer (LocalStorage)
    const LS_USERS = "arcon_users_v1";
    const LS_SESSION = "arcon_session_v1";
    const LS_APPS = "arcon_apps_v1"; // all apps (multi user) for verification demo

    let currentUser = null;
    let currentVerifyCert = null;

    function loadUsers(){ return JSON.parse(localStorage.getItem(LS_USERS) || "[]"); }
    function saveUsers(users){ localStorage.setItem(LS_USERS, JSON.stringify(users)); }

    function loadApps(){ return JSON.parse(localStorage.getItem(LS_APPS) || "[]"); }
    function saveApps(apps){ localStorage.setItem(LS_APPS, JSON.stringify(apps)); }

    function setSession(email){
      localStorage.setItem(LS_SESSION, JSON.stringify({ email, ts: nowISO() }));
    }
    function getSession(){
      try { return JSON.parse(localStorage.getItem(LS_SESSION) || "null"); } catch { return null; }
    }
    function clearSession(){ localStorage.removeItem(LS_SESSION); }

    // ===== UI Switching
    function showHome(){
      getEl('home').classList.remove('hidden');
      getEl('dashboard').classList.add('hidden');
      getEl('btn-login').classList.toggle('hidden', !!currentUser);
      getEl('btn-logout').classList.toggle('hidden', !currentUser);
    }
    function showDashboard(){
      getEl('home').classList.add('hidden');
      getEl('dashboard').classList.remove('hidden');
      getEl('btn-login').classList.add('hidden');
      getEl('btn-logout').classList.remove('hidden');
    }

    function switchTab(tab){
      getEl('tab-apply').classList.toggle('hidden', tab !== 'apply');
      getEl('tab-status').classList.toggle('hidden', tab !== 'status');
      if(tab === 'status') renderApps();
    }

    function gateToDashboard(tab){
      if(!currentUser){
        openAuthModal();
        authTab('register');
        return;
      }
      showDashboard();
      switchTab(tab);
    }

    // ===== Auth Modal
    function openAuthModal(){
      getEl('auth-modal').classList.remove('hidden');
      getEl('auth-modal').classList.add('flex');
      authTab('login');
    }
    function closeAuthModal(){
      getEl('auth-modal').classList.add('hidden');
      getEl('auth-modal').classList.remove('flex');
    }
    function authTab(which){
      const btnL = getEl('auth-tab-login');
      const btnR = getEl('auth-tab-register');
      const login = getEl('auth-login');
      const reg = getEl('auth-register');
      if(which === 'login'){
        btnL.className = "tap px-4 py-3 rounded-2xl font-black bg-ink text-white";
        btnR.className = "tap px-4 py-3 rounded-2xl font-black bg-white border border-gray-200 hover:border-arconGreen";
        login.classList.remove('hidden');
        reg.classList.add('hidden');
      }else{
        btnR.className = "tap px-4 py-3 rounded-2xl font-black bg-ink text-white";
        btnL.className = "tap px-4 py-3 rounded-2xl font-black bg-white border border-gray-200 hover:border-arconGreen";
        reg.classList.remove('hidden');
        login.classList.add('hidden');
      }
    }

    function doRegister(){
      const name = (getEl('reg-name').value || "").trim();
      const rc = (getEl('reg-rc').value || "").trim();
      const email = (getEl('reg-email').value || "").trim().toLowerCase();
      const phone = (getEl('reg-phone').value || "").trim();
      const pass = (getEl('reg-pass').value || "").trim();

      if(!name || !rc || !email || !phone || !pass){
        alert("Complete registration: Company Name, RC Number, Email, Phone, Password are required.");
        return;
      }
      if(!/^rc/i.test(rc)){
        // enforce real RC style (still allows numbers like 12345? no. must start with RC)
        alert("RC Number must start with 'RC' (e.g. RC123456).");
        return;
      }

      const users = loadUsers();
      if(users.some(u => u.email === email)){
        alert("An account with this email already exists. Please login.");
        authTab('login');
        return;
      }
      if(users.some(u => (u.rc || "").toLowerCase() === rc.toLowerCase())){
        alert("This RC Number is already registered. Please login with the original email.");
        authTab('login');
        return;
      }

      users.push({ name, rc, email, phone, pass, createdAt: nowISO() });
      saveUsers(users);

      // auto login
      currentUser = { name, rc, email, phone };
      setSession(email);
      hydrateAccountUI();
      closeAuthModal();
      showDashboard();
      switchTab('apply');
      syncAgencyToUser();
      toast("Account created", "Registration complete. Your RC identity is now locked to your advertiser profile.", "ok");
    }

    function doLogin(){
      const email = (getEl('login-email').value || "").trim().toLowerCase();
      const pass = (getEl('login-pass').value || "").trim();

      if(!email || !pass){
        alert("Enter your email and password.");
        return;
      }

      const users = loadUsers();
      const user = users.find(u => u.email === email && u.pass === pass);
      if(!user){
        alert("Invalid login. Check email/password or register.");
        return;
      }

      currentUser = { name: user.name, rc: user.rc, email: user.email, phone: user.phone };
      setSession(email);
      hydrateAccountUI();
      closeAuthModal();
      showDashboard();
      switchTab('apply');
      syncAgencyToUser();
      toast("Logged in", "Welcome back. Your advertiser profile is linked to RC Number.", "ok");
    }

    function logout(){
      currentUser = null;
      clearSession();
      showHome();
      toast("Logged out", "Session ended successfully.", "info");
    }

    // ===== Agency Auto-Sync (company = logged in user, RC required)
    function syncAgencyToUser(){
      if(!currentUser) return;

      getEl('agency-name').value = currentUser.name || "";
      getEl('agency-contact').value = currentUser.name || "";
      getEl('agency-email').value = currentUser.email || "";
      getEl('agency-phone').value = currentUser.phone || "";
      getEl('agency-rc').value = currentUser.rc || "";

      const lockIds = ['agency-name','agency-contact','agency-email','agency-phone','agency-rc'];
      lockIds.forEach(id => {
        const el = getEl(id);
        if(!el) return;
        el.readOnly = true;
        el.classList.add('bg-gray-50');
      });
    }

    function hydrateAccountUI(){
      if(!currentUser) return;
      getEl('dash-name').textContent = currentUser.name;
      getEl('acct-company').textContent = currentUser.name;
      getEl('acct-rc').textContent = currentUser.rc;
      getEl('acct-email').textContent = currentUser.email;
      getEl('acct-phone').textContent = currentUser.phone;
    }

    // ===== Fee Calculation (simple, deterministic)
    function calcFee(){
      const media = (getEl('media-type')?.value || "");
      const duration = Number(getEl('duration')?.value || 30);
      let base = 150000;

      if(media === "Billboard") base = 250000;
      if(media === "LED Screen") base = 350000;
      if(media === "Transit (Bus / Taxi)") base = 200000;
      if(media === "Print (Flyer / Poster)") base = 120000;
      if(media === "Digital (Social / Web)") base = 100000;

      const durFactor = Math.max(1, Math.ceil(duration / 30));
      const total = base * durFactor;

      getEl('fee-amt').textContent = total.toLocaleString();
      return total;
    }

    // ===== Application submit
    async function handleFormSubmit(e){
      e.preventDefault();
      if(!currentUser){
        alert("Please login before submitting.");
        openAuthModal();
        return;
      }

      const rcNow = (getEl('agency-rc').value || '').trim();
      if(!rcNow) return alert("RC Number is required.");

      const app = {
        id: cryptoRandomRef(),
        certNo: "", // assigned on approval / certificate generation
        createdAt: nowISO(),
        submittedAt: nowISO(),
        status: "Submitted",
        reviewerNote: "Pending review",
        company: {
          name: currentUser.name,
          rc: currentUser.rc,
          email: currentUser.email,
          phone: currentUser.phone,
        },
        licenseType: getEl('license-type').value,
        jurisdiction: getEl('jurisdiction').value,
        state: getEl('state').value.trim(),
        address: getEl('address').value.trim(),
        mediaType: getEl('media-type').value,
        durationDays: Number(getEl('duration').value || 30),
        assetNotes: getEl('asset-notes').value.trim(),
        fee: calcFee(),
        invoiceNo: `INV-${new Date().getFullYear()}-${pad(nextInvoiceSeq(), 6)}`,
        // store creative as base64
        creatives: [],
        paymentProof: null,
        // used for verification details
        issuedAt: null
      };

      if(!app.licenseType || !app.jurisdiction || !app.state || !app.address || !app.mediaType || !app.assetNotes){
        alert("Please complete all required fields.");
        return;
      }

      // Creative files (required)
      const files = getEl('creative-files').files;
      if(!files || files.length === 0){
        alert("Upload at least one creative image.");
        return;
      }

      // Convert creatives to base64
      app.creatives = await Promise.all([...files].slice(0, 8).map(fileToDataUrl));

      // Optional payment evidence
      const proof = getEl('payment-proof').files?.[0];
      if(proof){
        app.paymentProof = await fileToDataUrl(proof);
      }

      // Save app
      const apps = loadApps();
      apps.unshift(app);
      saveApps(apps);

      // Reset form
      getEl('application-form').reset();
      syncAgencyToUser();
      calcFee();

      // Soft auto-progress for demo (so status page shows movement)
      demoAutoProgress(app.id);

      toast("Application submitted", `Reference: ${app.id}. Download your invoice or track status.`, "ok");

      switchTab('status');
      renderApps();
    }

    function cryptoRandomRef(){
      // Format like ARCON-APP-2025-XXXXXX
      const yr = new Date().getFullYear();
      const rand = Math.floor(Math.random() * 1000000);
      return `ARCON-APP-${yr}-${pad(rand, 6)}`;
    }

    function nextInvoiceSeq(){
      const key = "arcon_invoice_seq_v1";
      const n = Number(localStorage.getItem(key) || "0") + 1;
      localStorage.setItem(key, String(n));
      return n;
    }

    function nextCertSeq(){
      const key = "arcon_cert_seq_v1";
      const n = Number(localStorage.getItem(key) || "0") + 1;
      localStorage.setItem(key, String(n));
      return n;
    }

    function fileToDataUrl(file){
      return new Promise((resolve, reject) => {
        const r = new FileReader();
        r.onload = () => resolve({ name: file.name, type: file.type, size: file.size, dataUrl: r.result });
        r.onerror = reject;
        r.readAsDataURL(file);
      });
    }

    // ===== Invoice download (real printable invoice window)
    function downloadDraftInvoice(){
      if(!currentUser){
        openAuthModal();
        authTab('register');
        return;
      }

      const invNo = `INV-${new Date().getFullYear()}-${pad(nextInvoiceSeq(), 6)}`;
      const fee = calcFee();

      const payload = {
        invoiceNo: invNo,
        createdAt: nowISO(),
        company: { ...currentUser },
        details: {
          licenseType: getEl('license-type').value || "—",
          jurisdiction: getEl('jurisdiction').value || "—",
          state: (getEl('state').value || "—").trim() || "—",
          mediaType: getEl('media-type').value || "—",
          durationDays: Number(getEl('duration').value || 30),
          fee
        }
      };
      openInvoiceWindow(payload, { watermark: "INVOICE (AWAITING PAYMENT)" });
    }

    function downloadInvoiceForApp(appId){
      const apps = loadApps();
      const app = apps.find(a => a.id === appId);
      if(!app) return alert("Application not found.");
      openInvoiceWindow({
        invoiceNo: app.invoiceNo,
        createdAt: app.submittedAt,
        company: app.company,
        details: {
          licenseType: app.licenseType,
          jurisdiction: `${app.jurisdiction} / ${app.state}`,
          state: app.state,
          mediaType: app.mediaType,
          durationDays: app.durationDays,
          fee: app.fee
        },
        ref: app.id
      }, { watermark: "INVOICE (AWAITING PAYMENT)" });
    }

    function openInvoiceWindow(inv, { watermark } = {}){
      const w = window.open("", "_blank", "width=920,height=720");
      if(!w) return alert("Popup blocked. Allow popups to download invoice.");
      const yr = new Date().getFullYear();
      const amount = Number(inv.details.fee || 0).toLocaleString();

      w.document.open();
      w.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8"/>
          <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
          <title>${escapeHtml(inv.invoiceNo)} - ARCON Invoice</title>
          <style>
            body{ font-family: Inter, Arial, sans-serif; margin:0; background:#f7fafc; color:#0b1220; }
            .page{ max-width: 860px; margin: 24px auto; background:white; border:1px solid #e5e7eb; border-radius: 18px; overflow:hidden; }
            .top{ padding: 22px 22px 14px; border-bottom:1px solid #e5e7eb; display:flex; justify-content:space-between; gap:16px; }
            .mark{ width:44px; height:44px; border-radius:14px; background:#0b1220; display:flex; align-items:center; justify-content:center; color:white; font-weight:900; letter-spacing:-.03em; }
            .meta{ text-align:right; }
            .meta .h{ font-size:12px; text-transform:uppercase; letter-spacing:.14em; color:#6b7280; font-weight:900; }
            .meta .n{ font-size:18px; font-weight:900; margin-top:6px; }
            .content{ padding: 18px 22px; }
            .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:14px; }
            .card{ border:1px solid #e5e7eb; border-radius: 14px; padding: 14px; }
            .k{ font-size:11px; text-transform:uppercase; letter-spacing:.14em; color:#6b7280; font-weight:900; }
            .v{ margin-top:6px; font-size:14px; font-weight:800; }
            .amount{ margin-top:14px; border:1px solid #e5e7eb; border-radius: 14px; padding: 14px; display:flex; justify-content:space-between; align-items:center; }
            .amt{ font-size:26px; font-weight:900; }
            .pay{ margin-top:14px; border:1px solid #e5e7eb; border-radius: 14px; padding: 14px; }
            .pay strong{ font-weight:900; }
            .foot{ padding: 16px 22px; border-top:1px solid #e5e7eb; font-size:12px; color:#6b7280; }
            .wm{
              position: fixed; inset:0; display:flex; align-items:center; justify-content:center;
              pointer-events:none; opacity:.08; font-size:64px; font-weight:900; transform: rotate(-18deg);
            }
            @media print{
              body{ background:white; }
              .page{ border:none; margin:0; border-radius:0; }
            }
          </style>
        </head>
        <body>
          ${watermark ? `<div class="wm">${escapeHtml(watermark)}</div>` : ``}
          <div class="page">
            <div class="top">
              <div style="display:flex; gap:12px; align-items:center;">
                <div class="mark">AR</div>
                <div>
                  <div style="font-weight:900;">Advertising Regulatory Council of Nigeria</div>
                  <div style="font-size:12px; color:#6b7280; font-weight:800; margin-top:2px;">Invoice for Advertiser Services</div>
                </div>
              </div>
              <div class="meta">
                <div class="h">Invoice No</div>
                <div class="n">${escapeHtml(inv.invoiceNo)}</div>
                <div style="margin-top:6px; font-size:12px; color:#6b7280;">Date: ${escapeHtml(fmtDate(inv.createdAt))}</div>
                ${inv.ref ? `<div style="margin-top:6px; font-size:12px; color:#6b7280;">Ref: ${escapeHtml(inv.ref)}</div>` : ``}
              </div>
            </div>

            <div class="content">
              <div class="grid">
                <div class="card">
                  <div class="k">Billed To</div>
                  <div class="v">${escapeHtml(inv.company.name)}</div>
                  <div style="margin-top:6px; font-size:13px;"><span style="color:#6b7280; font-weight:800;">RC:</span> <span style="font-weight:900;">${escapeHtml(inv.company.rc)}</span></div>
                  <div style="margin-top:6px; font-size:13px;"><span style="color:#6b7280; font-weight:800;">Email:</span> <span style="font-weight:900;">${escapeHtml(inv.company.email)}</span></div>
                  <div style="margin-top:6px; font-size:13px;"><span style="color:#6b7280; font-weight:800;">Phone:</span> <span style="font-weight:900;">${escapeHtml(inv.company.phone)}</span></div>
                </div>

                <div class="card">
                  <div class="k">Service Details</div>
                  <div style="margin-top:10px; font-size:13px;"><span style="color:#6b7280; font-weight:800;">License:</span> <span style="font-weight:900;">${escapeHtml(inv.details.licenseType)}</span></div>
                  <div style="margin-top:6px; font-size:13px;"><span style="color:#6b7280; font-weight:800;">Jurisdiction:</span> <span style="font-weight:900;">${escapeHtml(inv.details.jurisdiction)}</span></div>
                  <div style="margin-top:6px; font-size:13px;"><span style="color:#6b7280; font-weight:800;">Media:</span> <span style="font-weight:900;">${escapeHtml(inv.details.mediaType)}</span></div>
                  <div style="margin-top:6px; font-size:13px;"><span style="color:#6b7280; font-weight:800;">Duration:</span> <span style="font-weight:900;">${escapeHtml(inv.details.durationDays)}</span> days</div>
                </div>
              </div>

              <div class="amount">
                <div>
                  <div class="k">Amount Due</div>
                  <div style="margin-top:6px; font-size:12px; color:#6b7280;">Pay to ARCON ADs VETTING account</div>
                </div>
                <div class="amt">₦ ${amount}</div>
              </div>

              <div class="pay">
                <div class="k">Payment Account</div>
                <div style="margin-top:10px; font-size:14px;">
                  <strong>ARCON ADs VETTING</strong><br/>
                  Stanbic IBTC Bank<br/>
                  <strong>5770242424</strong>
                </div>
                <div style="margin-top:10px; font-size:12px; color:#6b7280;">
                  After payment, upload evidence to your application and download your receipt/certificate from Status.
                </div>
              </div>
            </div>

            <div class="foot">
              © ${yr} ARCON Integrated Platform • This invoice is computer-generated and valid without signature.
            </div>
          </div>

          <script>
            window.onload = () => setTimeout(() => window.print(), 250);
          <\/script>
        </body>
        </html>
      `);
      w.document.close();
    }

    // ===== Status table
    function renderApps(){
      const tbody = getEl('apps-tbody');
      tbody.innerHTML = "";

      const apps = loadApps();
      const mine = currentUser ? apps.filter(a => a.company?.email === currentUser.email) : [];

      getEl('no-apps').classList.toggle('hidden', mine.length !== 0);

      mine.forEach(app => {
        const statusPill = statusBadge(app.status);
        const tr = document.createElement('tr');
        tr.className = "border-b last:border-0";
        tr.innerHTML = `
          <td class="py-3 pr-4 font-black text-ink">${escapeHtml(app.id)}</td>
          <td class="py-3 pr-4 font-semibold text-gray-700">${escapeHtml(app.licenseType)}</td>
          <td class="py-3 pr-4">${statusPill}</td>
          <td class="py-3 pr-4 text-gray-600">${escapeHtml(fmtDate(app.submittedAt))}</td>
          <td class="py-3 pr-4">
            <div class="flex flex-wrap gap-2">
              <button class="tap px-3 py-2 rounded-xl font-black text-xs border border-gray-200 hover:border-arconGreen bg-white"
                      onclick="downloadInvoiceForApp('${escapeHtml(app.id)}')">
                Invoice
              </button>
              <button class="tap px-3 py-2 rounded-xl font-black text-xs border border-gray-200 hover:border-arconGreen bg-white"
                      onclick="markPaid('${escapeHtml(app.id)}')">
                Mark Paid
              </button>
              <button class="tap px-3 py-2 rounded-xl font-black text-xs bg-ink text-white hover:bg-black"
                      onclick="generateCertificate('${escapeHtml(app.id)}')">
                Certificate
              </button>
            </div>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function statusBadge(status){
      const map = {
        "Submitted": "bg-gray-100 text-gray-700 border-gray-200",
        "Under Review": "bg-blue-50 text-blue-700 border-blue-200",
        "Approved": "bg-green-50 text-green-700 border-green-200",
        "Rejected": "bg-red-50 text-red-700 border-red-200",
        "Payment Pending": "bg-yellow-50 text-yellow-700 border-yellow-200"
      };
      const cls = map[status] || map["Submitted"];
      return `<span class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full border ${cls} text-xs font-black">
        <span class="w-2 h-2 rounded-full ${statusDot(status)}"></span>${escapeHtml(status)}
      </span>`;
    }
    function statusDot(status){
      if(status==="Approved") return "bg-arconGreen";
      if(status==="Under Review") return "bg-blue-600";
      if(status==="Rejected") return "bg-red-600";
      if(status==="Payment Pending") return "bg-arconYellow2";
      return "bg-gray-400";
    }

    function markPaid(appId){
      const apps = loadApps();
      const idx = apps.findIndex(a => a.id === appId);
      if(idx < 0) return alert("Application not found.");

      // If already approved, keep it. Else move to Under Review.
      if(apps[idx].status !== "Approved"){
        apps[idx].status = "Under Review";
        apps[idx].reviewerNote = "Payment confirmed, review in progress.";
        saveApps(apps);
        renderApps();
        toast("Payment flagged", "Status updated to Under Review.", "info");
      }else{
        toast("Already approved", "This application is already approved.", "info");
      }
    }

    // Demo-only: simulate review progression
    function demoAutoProgress(appId){
      const step1 = setTimeout(() => {
        const apps = loadApps();
        const a = apps.find(x => x.id === appId);
        if(!a) return;
        if(a.status === "Submitted"){
          a.status = "Payment Pending";
          a.reviewerNote = "Awaiting payment confirmation.";
          saveApps(apps);
          if(getEl('tab-status') && !getEl('tab-status').classList.contains('hidden')) renderApps();
        }
      }, 1500);

      const step2 = setTimeout(() => {
        const apps = loadApps();
        const a = apps.find(x => x.id === appId);
        if(!a) return;
        if(a.status === "Payment Pending"){
          a.status = "Under Review";
          a.reviewerNote = "Review started.";
          saveApps(apps);
          if(getEl('tab-status') && !getEl('tab-status').classList.contains('hidden')) renderApps();
        }
      }, 5200);

      const step3 = setTimeout(() => {
        const apps = loadApps();
        const a = apps.find(x => x.id === appId);
        if(!a) return;
        if(a.status === "Under Review"){
          a.status = "Approved";
          a.reviewerNote = "Approved. Certificate ready.";
          // assign certNo once approved (stable)
          if(!a.certNo){
            const yr = new Date().getFullYear();
            a.certNo = `ARCON-${yr}-${pad(nextCertSeq(), 6)}`;
            a.issuedAt = nowISO();
          }
          saveApps(apps);
          if(getEl('tab-status') && !getEl('tab-status').classList.contains('hidden')) renderApps();
          pushSocialProofImmediate("Approval Granted", "A company just got an ad approved.", "ph-seal-check");
        }
      }, 9800);

      return () => { clearTimeout(step1); clearTimeout(step2); clearTimeout(step3); };
    }

    // ===== Certificate generation / viewing
    function generateCertificate(appId){
      const apps = loadApps();
      const app = apps.find(a => a.id === appId);
      if(!app) return alert("Application not found.");

      // enforce RC non-optional and correct
      if(!app.company?.rc) return alert("RC Number is missing. Certificate cannot be generated.");
      if(app.company.rc !== currentUser.rc) return alert("Security: advertiser mismatch. Certificate belongs to a different RC.");

      // If not approved, still allow preview but mark as pending
      if(!app.certNo){
        const yr = new Date().getFullYear();
        app.certNo = `ARCON-${yr}-${pad(nextCertSeq(), 6)}`;
        app.issuedAt = nowISO();
        // keep status as is, but cert exists as a verifiable record
        saveApps(apps);
      }

      openCertificate(app.certNo);
    }

    function openCertificate(certNo){
      const apps = loadApps();
      const app = apps.find(a => a.certNo === certNo);
      if(!app) return alert("Certificate not found.");

      // Fill certificate fields
      getEl('cert-number').textContent = app.certNo;
      getEl('cert-issued').textContent = fmtDate(app.issuedAt || app.submittedAt);
      getEl('cert-company').textContent = app.company.name;
      getEl('cert-rc').textContent = app.company.rc;
      getEl('cert-license').textContent = app.licenseType;
      getEl('cert-media-type').textContent = app.mediaType;
      getEl('cert-duration').textContent = String(app.durationDays);
      getEl('cert-juris').textContent = `${app.jurisdiction} / ${app.state}`;
      getEl('cert-notes').textContent = app.assetNotes;

      // Media thumbnails
      const mediaWrap = getEl('cert-media');
      mediaWrap.innerHTML = "";
      (app.creatives || []).slice(0, 8).forEach((c) => {
        const box = document.createElement('div');
        box.className = "rounded-xl overflow-hidden border border-gray-200 bg-gray-50";
        box.innerHTML = `
          <div class="aspect-[4/3] overflow-hidden bg-gray-100">
            <img src="${c.dataUrl}" alt="${escapeHtml(c.name)}" class="w-full h-full object-cover">
          </div>
          <div class="p-2 text-[10px] text-gray-600 font-extrabold truncate">${escapeHtml(c.name)}</div>
        `;
        mediaWrap.appendChild(box);
      });

      // QR generation (guaranteed library loaded)
      const qrWrap = getEl('cert-qrcode');
      qrWrap.innerHTML = "";

      // QR payload: structured JSON for verification
      const payload = JSON.stringify({
        certNo: app.certNo,
        rc: app.company.rc,
        company: app.company.name,
        mediaType: app.mediaType,
        issuedAt: app.issuedAt || app.submittedAt
      });

      try{
        if(typeof QRCode === "undefined") throw new Error("QRCode library not loaded.");
        new QRCode(qrWrap, {
          text: payload,
          width: 160,
          height: 160,
          correctLevel: QRCode.CorrectLevel.H
        });
      }catch(err){
        // fallback: show cert number anyway
        qrWrap.innerHTML = `<div class="text-xs text-red-600 font-black">QR error: ${escapeHtml(err.message)}</div>`;
      }

      // show modal
      getEl('certificate-modal').classList.remove('hidden');
      getEl('certificate-modal').classList.add('flex');

      // keep a handle for QR download
      currentVerifyCert = app.certNo;
    }

    function closeCertificateModal(){
      getEl('certificate-modal').classList.add('hidden');
      getEl('certificate-modal').classList.remove('flex');
    }

    function downloadCertificateQR(){
      const wrap = getEl('cert-qrcode');
      const img = wrap.querySelector("img");
      const canvas = wrap.querySelector("canvas");
      let dataUrl = null;

      if(img && img.src) dataUrl = img.src;
      if(!dataUrl && canvas) dataUrl = canvas.toDataURL("image/png");

      if(!dataUrl) return alert("QR not ready. Try again.");

      const a = document.createElement('a');
      a.href = dataUrl;
      a.download = `${currentVerifyCert || "ARCON-CERT"}-QR.png`;
      document.body.appendChild(a);
      a.click();
      a.remove();
    }

    // ===== Verify Modal
    let scannerRunning = false;
    let html5Qr = null;

    function openVerifyModal(){
      getEl('verify-modal').classList.remove('hidden');
      getEl('verify-modal').classList.add('flex');
      // reset result
      getEl('verify-result').classList.add('hidden');
      currentVerifyCert = null;
    }
    function closeVerifyModal(){
      stopScanner();
      getEl('verify-modal').classList.add('hidden');
      getEl('verify-modal').classList.remove('flex');
    }

    function toggleScanner(){
      if(scannerRunning) stopScanner();
      else startScanner();
    }

    async function startScanner(){
      const label = getEl('scanner-toggle-label');
      label.textContent = "Stop";

      if(!html5Qr) html5Qr = new Html5Qrcode("reader");

      const boxSize = Math.max(180, Math.min(260, Math.floor(window.innerWidth * 0.72)));
      const config = { fps: 10, qrbox: { width: boxSize, height: boxSize }, aspectRatio: 1.0 };

      try{
        scannerRunning = true;
        await html5Qr.start(
          { facingMode: "environment" },
          config,
          (decodedText) => {
            // decodedText is JSON payload (we generate it)
            try{
              const obj = JSON.parse(decodedText);
              if(obj && obj.certNo){
                getEl('verify-cert-no').value = obj.certNo;
                verifyCertificate();
                stopScanner();
              }else{
                // fallback: if only cert number
                getEl('verify-cert-no').value = decodedText.trim();
                verifyCertificate();
                stopScanner();
              }
            }catch{
              getEl('verify-cert-no').value = decodedText.trim();
              verifyCertificate();
              stopScanner();
            }
          },
          () => {}
        );
      }catch(err){
        scannerRunning = false;
        label.textContent = "Start";
        alert("Camera start failed. Check permissions and try again.\n\n" + err);
      }
    }

    async function stopScanner(){
      const label = getEl('scanner-toggle-label');
      label.textContent = "Start";
      if(!html5Qr) return;
      if(!scannerRunning) return;

      try{
        await html5Qr.stop();
        await html5Qr.clear();
      }catch{}
      scannerRunning = false;
    }

    function verifyCertificate(){
      const certNo = (getEl('verify-cert-no').value || "").trim();
      if(!certNo) return alert("Enter a certificate number.");

      const apps = loadApps();
      const app = apps.find(a => a.certNo === certNo);

      const result = getEl('verify-result');
      result.classList.remove('hidden');

      const badge = getEl('verify-badge');
      const title = getEl('verify-title');
      const sub = getEl('verify-sub');

      if(!app){
        badge.className = "w-11 h-11 rounded-2xl flex items-center justify-center text-xl bg-red-50 text-red-700";
        badge.innerHTML = `<i class="ph ph-x-circle"></i>`;
        title.textContent = "Not Valid";
        sub.textContent = "No matching certificate record found.";
        fillVerifyCards({ company:"—", rc:"—", media:"—", issued:"—" });
        currentVerifyCert = null;
        return;
      }

      badge.className = "w-11 h-11 rounded-2xl flex items-center justify-center text-xl bg-green-50 text-green-700";
      badge.innerHTML = `<i class="ph ph-check-circle"></i>`;
      title.textContent = "Verified";
      sub.textContent = `Certificate matches advertiser record and submission metadata.`;

      fillVerifyCards({
        company: app.company.name,
        rc: app.company.rc,
        media: app.mediaType,
        issued: fmtDate(app.issuedAt || app.submittedAt),
      });

      currentVerifyCert = certNo;
      currentVerifyCertAppId = app.id;
    }

    function fillVerifyCards({ company, rc, media, issued }){
      getEl('v-company').textContent = company;
      getEl('v-rc').textContent = rc;
      getEl('v-media').textContent = media;
      getEl('v-issued').textContent = issued;
    }

    let currentVerifyCertAppId = null;
    function openCertificateFromVerify(){
      if(!currentVerifyCert) return alert("Verify a valid certificate first.");
      closeVerifyModal();
      openCertificate(currentVerifyCert);
    }

    // ===== Social proof (live pop notifications)
    const PROOF_EVENTS = [
      { title: "Vetting Paid", body: "An advertiser just paid for ad vetting.", icon: "ph-shield-check" },
      { title: "Approval Granted", body: "A company just got an ad approved.", icon: "ph-seal-check" },
      { title: "Asset Verified", body: "Someone verified a certificate via QR scan.", icon: "ph-scan" },
      { title: "Renewal Completed", body: "A license renewal was completed.", icon: "ph-arrows-clockwise" },
    ];

    function pushSocialProofImmediate(title, body, icon){
      const wrap = getEl('social-proof');
      if(!wrap) return;

      const el = document.createElement('div');
      el.className = "pointer-events-none bg-white border border-gray-200 shadow-xl rounded-2xl px-4 py-3 flex items-start gap-3 opacity-0 translate-y-2 transition-all duration-300";
      el.innerHTML = `
        <div class="w-10 h-10 rounded-xl bg-green-50 flex items-center justify-center text-arconGreen text-xl flex-shrink-0">
          <i class="ph ${icon}"></i>
        </div>
        <div class="flex-1">
          <div class="flex items-center justify-between gap-2">
            <p class="font-black text-gray-900 text-sm">${escapeHtml(title)}</p>
            <span class="text-[10px] font-black text-gray-400 uppercase">Just now</span>
          </div>
          <p class="text-xs text-gray-600 mt-0.5">${escapeHtml(body)}</p>
        </div>
      `;

      wrap.prepend(el);
      requestAnimationFrame(() => {
        el.classList.remove("opacity-0","translate-y-2");
        el.classList.add("opacity-100","translate-y-0");
      });

      setTimeout(() => {
        el.classList.remove("opacity-100","translate-y-0");
        el.classList.add("opacity-0","translate-y-2");
        setTimeout(() => el.remove(), 350);
      }, 4200);

      [...wrap.children].slice(4).forEach(k => k.remove());
    }

    function pushSocialProof(){
      const e = PROOF_EVENTS[Math.floor(Math.random() * PROOF_EVENTS.length)];
      pushSocialProofImmediate(e.title, e.body, e.icon);
    }

    function scheduleSocialProof(){
      const delay = Math.floor(6000 + Math.random() * 7000);
      setTimeout(() => {
        if(!document.hidden) pushSocialProof();
        scheduleSocialProof();
      }, delay);
    }

    // ===== Toast (small helper)
    function toast(title, body, type="info"){
      pushSocialProofImmediate(title, body, type==="ok" ? "ph-check-circle" : type==="info" ? "ph-info" : "ph-warning");
    }

    // ===== Counter animation
    function animateCounters(){
      const els = document.querySelectorAll('[data-counter]');
      els.forEach(el => {
        const target = Number(el.getAttribute('data-counter')) || 0;
        const dur = 900;
        const t0 = performance.now();
        function tick(t){
          const p = Math.min(1, (t - t0) / dur);
          const v = Math.floor(target * (1 - Math.pow(1 - p, 3)));
          el.textContent = v.toLocaleString();
          if(p < 1) requestAnimationFrame(tick);
        }
        requestAnimationFrame(tick);
      });
    }

    // ===== Init
    function init(){
      getEl('year').textContent = new Date().getFullYear();

      // fee live updates
      ["media-type","duration"].forEach(id => {
        const el = getEl(id);
        if(el) el.addEventListener('change', calcFee);
        if(el) el.addEventListener('input', calcFee);
      });
      calcFee();

      // try session
      const sess = getSession();
      if(sess?.email){
        const users = loadUsers();
        const u = users.find(x => x.email === sess.email);
        if(u){
          currentUser = { name: u.name, rc: u.rc, email: u.email, phone: u.phone };
          hydrateAccountUI();
          showDashboard();
          switchTab('apply');
          // ensure agency locks
          setTimeout(syncAgencyToUser, 0);
        }else{
          showHome();
        }
      }else{
        showHome();
      }

      // start social proof loop and counters
      scheduleSocialProof();
      animateCounters();
    }

    document.addEventListener("DOMContentLoaded", init);

    // Close modals on ESC
    document.addEventListener("keydown", (e) => {
      if(e.key === "Escape"){
        closeVerifyModal();
        closeAuthModal();
        closeCertificateModal();
      }
    });

    // ===== Close/open convenience
    function openAuthModal(){ getEl('auth-modal').classList.remove('hidden'); getEl('auth-modal').classList.add('flex'); authTab('login'); }
    function closeAuthModal(){ getEl('auth-modal').classList.add('hidden'); getEl('auth-modal').classList.remove('flex'); }

    // ensure verify modal can be opened from header before init
    function openVerifyModal(){ getEl('verify-modal').classList.remove('hidden'); getEl('verify-modal').classList.add('flex'); getEl('verify-result').classList.add('hidden'); currentVerifyCert = null; }
    function closeVerifyModal(){ stopScanner(); getEl('verify-modal').classList.add('hidden'); getEl('verify-modal').classList.remove('flex'); }
  </script>
</body>
</html>
